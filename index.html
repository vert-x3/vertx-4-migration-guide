<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>About Vert.x</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#about-vertx_{context}">About Vert.x</a></li>
<li><a href="#what-is-new-and-different-in-vertx-4_{context}">What&#8217;s changed in Vert.x 4</a>
<ul class="sectlevel2">
<li><a href="#use-future-methods-instead-of-callback-for-asynchronous-operations_what-is-new-and-different-in-vertx-4">Use future methods for asynchronous operations</a></li>
<li><a href="#no_dependency_on_the_jackson_databind_library_what-is-new-and-different-in-vertx-4">No dependency on the Jackson Databind library</a></li>
<li><a href="#handling_deprecations_and_removals_what-is-new-and-different-in-vertx-4">Handling deprecations and removals</a></li>
</ul>
</li>
<li><a href="#changes-in-common-components_{context}">Changes in common components</a>
<ul class="sectlevel2">
<li><a href="#changes-in-messaging_changes-in-common-components">Changes in messaging</a></li>
<li><a href="#changes-in-eventbus_changes-in-common-components">Changes in EventBus</a></li>
<li><a href="#changes-in-handlers_changes-in-common-components">Changes in future</a></li>
<li><a href="#changes-in-verticles_changes-in-common-components">Changes in verticles</a></li>
<li><a href="#changes-in-threads_changes-in-common-components">Changes in threads</a></li>
<li><a href="#changes-in-http_changes-in-common-components">Changes in HTTP</a></li>
<li><a href="#changes-in-connection_changes-in-common-components">Changes in connection methods</a></li>
<li><a href="#changes-in-logging_changes-in-common-components">Changes in logging</a></li>
<li><a href="#changes-in-vertx-reactive-extensions_changes-in-common-components">Changes in Vert.x Reactive Extensions (Rx)</a></li>
<li><a href="#changes-in-vertx-config_changes-in-common-components">Changes in Vert.x configuration</a></li>
<li><a href="#changes-in-json_changes-in-common-components">Changes in JSON</a></li>
<li><a href="#changes-in-vertx-webchanges-in-common-components">Changes in Vert.x web</a></li>
<li><a href="#changes-in-vertx-web-graphql_changes-in-common-components">Changes in Vert.x Web GraphQL</a></li>
<li><a href="#changes-in-micrometer-metrics_changes-in-common-components">Changes in Micrometer metrics</a></li>
<li><a href="#changes-in-vertx-openapi_changes-in-common-components">Changes in Vert.x OpenAPI</a></li>
</ul>
</li>
<li><a href="#changes-in-microservices-patterns_{context}">Changes in microservices patterns</a>
<ul class="sectlevel2">
<li><a href="#changes-in-vertx-circuit-breaker_changes-in-microservices-patterns">Changes in Vert.x circuit breaker</a></li>
<li><a href="#changes-in-vertx-service-discovery_changes-in-microservices-patterns">Changes in Vert.x service discovery</a></li>
</ul>
</li>
<li><a href="#authentication-and-authorization_{context}">Changes in Vert.x authentication and authorization</a>
<ul class="sectlevel2">
<li><a href="#migrating-authentication-applications_authentication-and-authorization">Migrating the authentication applications</a></li>
<li><a href="#migrating-authorization-applications_authentication-and-authorization">Migrating the authorization applications</a></li>
<li><a href="#changes-in-key-management_authentication-and-authorization">Changes in key management</a></li>
<li><a href="#deprecated-and-removed-authentication-and-authorization-methods_authentication-and-authorization">Deprecated and removed authentication and authorization methods</a></li>
</ul>
</li>
<li><a href="#changes-in-protocols_{context}">Changes in protocols</a>
<ul class="sectlevel2">
<li><a href="#changes-in-vertx-grpc_changes-in-protocols">Changes in Vert.x gRPC</a></li>
<li><a href="#changes-in-vertx-mqtt_changes-in-protocols">Changes in Vert.x MQTT</a></li>
<li><a href="#changes-in-vertx-service-proxy_changes-in-protocols">Changes in Vert.x Service Proxy</a></li>
</ul>
</li>
<li><a href="#changes-in-client-components_{context}">Changes in client components</a>
<ul class="sectlevel2">
<li><a href="#changes-in-vertx-kafka-client_changes-in-client-components">Changes in Vert.x Kafka client</a></li>
<li><a href="#changes-in-vertx-jdbc-client_changes-in-client-components">Changes in Vert.x JDBC client</a></li>
<li><a href="#changes-in-vertx-mail-client_changes-in-client-components">Changes in Vert.x mail client</a></li>
<li><a href="#changes-in-vertx-amqp-client_changes-in-client-components">Changes in Vert.x AMQP client</a></li>
<li><a href="#changes-in-vertx-mongodb-client_changes-in-client-components">Changes in Vert.x MongoDB client</a></li>
<li><a href="#changes-in-eventbus-javascript-client_changes-in-client-components">Changes in EventBus JavaScript client</a></li>
<li><a href="#changes-in-vertx-redis-client_changes-in-client-components">Changes in Vert.x Redis client</a></li>
<li><a href="#changes-in-vertx-cassandra-client_changes-in-client-components">Changes in Vert.x Cassandra client</a></li>
<li><a href="#_rabbitmq_client">RabbitMQ Client</a></li>
</ul>
</li>
<li><a href="#changes-in-clustering_{context}">Changes in clustering</a>
<ul class="sectlevel2">
<li><a href="#clustered_flag_removed_from_option_classes_changes-in-clustering">Clustered flag removed from options classes</a></li>
<li><a href="#changes-in-hazelcast-cluster-manager_changes-in-clustering">Changes in Hazelcast cluster manager</a></li>
<li><a href="#changes-in-infinispan-cluster-manager_changes-in-clustering">Changes in Infinispan cluster manager</a></li>
<li><a href="#changes-in-ignite-cluster-manager_changes-in-clustering">Changes in Apache Ignite cluster manager</a></li>
<li><a href="#migrating_clusters_changes-in-clustering">Migrating clusters</a></li>
</ul>
</li>
<li><a href="#miscellaneous-changes-in-vertx_{context}">Miscellaneous changes in Vert.x</a>
<ul class="sectlevel2">
<li><a href="#_removed_the_code_starter_code_class">Removed the <code>Starter</code> class</a></li>
<li><a href="#_isolated_deployment_for_java_8">Isolated deployment for Java 8</a></li>
<li><a href="#_removed_hook_methods_from_vert_x_context">Removed hook methods from Vert.x context</a></li>
<li><a href="#_removed_the_clone_methods_from_options">Removed the clone methods from options</a></li>
<li><a href="#_removed_equals_and_hashcode_methods_from_options">Removed equals and hashcode methods from options</a></li>
<li><a href="#_new_method_to_check_file_caching">New method to check file caching</a></li>
<li><a href="#_service_provider_interface_spi_metrics">Service Provider Interface (SPI) metrics</a></li>
<li><a href="#_removed_the_pooled_buffer_methods">Removed the pooled buffer methods</a></li>
<li><a href="#_methods_to_create_clients_that_have_no_shared_data_sources">Methods to create clients that have no shared data sources</a></li>
<li><a href="#changes-in-vertx-junit5_{context}">Changes in Vert.x JUnit5</a></li>
<li><a href="#_kotlin_changes">Kotlin changes</a></li>
<li><a href="#_testing_mongo_db_code">Testing Mongo DB Code</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ECLIPSE VERT.X 4 MIGRATION GUIDE</p>
</div>
<div class="paragraph">
<p>This guide describes the updates in Eclipse Vert.x 4 release. Use the information to upgrade your Vert.x 3.x applications to Vert.x 4. It provides information about the new, deprecated and unsupported features in this release.</p>
</div>
<div class="paragraph">
<p>Depending on the modules used in your application, you can read the relevant section to know more about the changes in Vert.x 4.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-vertx_{context}">About Vert.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x is a toolkit used for creating reactive, non-blocking, and asynchronous applications that run on Java Virtual Machine. (JVM). It contains several components that help you create reactive applications. It is designed to be cloud-native.</p>
</div>
<div class="paragraph">
<p>Since Vert.x supports asynchronous applications it can be used to create applications with high volume of messages, large event processing, HTTP interactions, and so on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-new-and-different-in-vertx-4_{context}">What&#8217;s changed in Vert.x 4</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the fundamental differences between Vert.x 4 and 3.x releases.</p>
</div>
<div class="sect2">
<h3 id="use-future-methods-instead-of-callback-for-asynchronous-operations_what-is-new-and-different-in-vertx-4">Use future methods for asynchronous operations</h3>
<div class="paragraph">
<p>Vert.x 4 uses futures for asynchronous operations. Every callback method has a corresponding future method. Futures can be used to compose asynchronous operations. You can use a combination of callback and future methods to migrate callback-based applications to Vert.x 4. However, you can also continue using callbacks for asynchronous operations.</p>
</div>
<div class="paragraph">
<p>The following example shows how a callback was used for asynchronous operations in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WebClient client = WebClient.create(vertx);
HttpRequest request = client.get("/resource");

request.send(ar -&gt; {
  if (ar.succeeded()) {
    HttpResponse response = ar.result();
  } else {
    Throwable error = ar.cause();
  }
});</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use callback and future methods together for asynchronous operations in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WebClient client = WebClient.create(vertx);
HttpRequest request = client.get("/resource");

Future&lt;HttpResponse&gt; response = request.send();

response.onComplete(ar -&gt; {
  if (ar.succeeded()) {
    HttpResponse response = ar.result();
  } else {
    Throwable failure = ar.cause();
  }
});</pre>
</div>
</div>
<div class="paragraph">
<p>Error handling is better with futures. In callbacks, you have to handle failures at every stage of the composition, whereas in futures you can handle the failure once in the end. In basic applications, you may not notice distinct difference between using callbacks and futures.</p>
</div>
<div class="paragraph">
<p>The following example shows how callbacks can be used to compose two asynchronous operations. You
can see that the error is handled at every composition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.get("/resource1").send(ar1 -&gt; {
  if (ar1.succeeded()) {
    HttpResponse response = ar.result();
    JsonObject json = response.body();
    client.put("/resource2").sendJsonObject(ar2 -&gt; {
      if (ar2.succeeded()) {
        // Handle final result
      } else {
        Throwable failure2 = ar.cause();
      }
    });
  } else {
    Throwable failure1 = ar.cause();
  }
});</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how callbacks and futures can be used to compose two asynchronous operations in Vert.x 4. The error is handled only once in the end.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Future&lt;HttpResponse&gt; fut1 = client.get("/resource1").send();

Future&lt;HttpResponse&gt; fut2 = fut1.compose(response -&gt; client.put("/resource2").sendJsonObject(response.body()));

fut2.onComplete(ar -&gt; {
  if (ar.succeeded()) {
    // Handle final result
  } else {
    Throwable failure = ar.cause();
  }
});</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="no_dependency_on_the_jackson_databind_library_what-is-new-and-different-in-vertx-4">No dependency on the Jackson Databind library</h3>
<div class="paragraph">
<p>The JSON features in Vert.x depend on Jackson library. Jackson Databind library enables object mapping of JSON.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, Jackson Databind is an optional Maven dependency. If you want to use this dependency, you must explicitly add it in the classpath.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are object mapping JSON, then you must explicitly add the dependency in your project descriptor in the <code>com.fasterxml.jackson.core:jackson-databind</code> jar.</p>
<div class="listingblock">
<div class="content">
<pre>&lt;dependencies&gt;
...
&lt;dependency&gt;
&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
&lt;/dependency&gt;
...
&lt;/dependencies&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In future, if you decide not to use object mapping of JSON, you can remove this dependency.</p>
</div>
</li>
<li>
<p>If you are not object mapping JSON, the Jackson Databind library is not required. You can run your applications without this jar.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="handling_deprecations_and_removals_what-is-new-and-different-in-vertx-4">Handling deprecations and removals</h3>
<div class="paragraph">
<p>Some features and functions have been deprecated or removed in Vert.x 4. Before you migrate your applications to Vert.x 4, check for deprecations and removals.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some APIs were deprecated in an Vert.x 3.x release and new equivalent APIs were provided in that release.</p>
</li>
<li>
<p>The deprecated APIs have been removed in Vert.x 4.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your application uses a deprecated API, you should update your application to use the new API. This helps in migrating applications to the latest version of the product.</p>
</div>
<div class="paragraph">
<p>The Java compiler generates warnings when deprecated APIs are used. You can use the compiler to check for deprecated methods while migrating applications to Vert.x 4.</p>
</div>
<div class="paragraph">
<p>The following example shows an EventBus method that was deprecated in an Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Send was deprecated in Vert.x 3.x release
vertx.eventBus().send("some-address", "hello world", ar -&gt; {
  // Handle response here
});</pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>send(String,String,Handler&lt;AsyncResult&lt;Message&gt;&gt;)</code> has been replaced in Vert.x 4 with the method <code>request(String,String,Handler&lt;AsyncResult&lt;Message&gt;&gt;</code>).</p>
</div>
<div class="paragraph">
<p>The following example shows how to update your application to use the new method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// New method can be used in Vert.x 3.x and Vert.x 4.x releases
vertx.eventBus().request("some-address", "hello world", ar -&gt; {
  // Handle response here
});</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-in-common-components_{context}">Changes in common components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the changes in basic Vert.x components.</p>
</div>
<div class="sect2">
<h3 id="changes-in-messaging_changes-in-common-components">Changes in messaging</h3>
<div class="paragraph">
<p>This section explains the changes in the messaging methods.</p>
</div>
<div class="sect3">
<h4 id="_write_and_end_methods_in_write_streams_are_no_longer_fluent">Write and end methods in write streams are no longer fluent</h4>
<div class="paragraph">
<p>The <code>WriteStream&lt;T&gt;.write()</code> and <code>WriteStream&lt;T&gt;.end()</code> methods are no longer fluent.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write and end callback methods return <code>void</code>.</p>
</li>
<li>
<p>Other write and end methods return <code>Future&lt;Void&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a breaking change. Update your applications if you have used the fluent aspect for write streams.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_messageproducer_code_does_not_extend_code_writestream_code"><code>MessageProducer</code> does not extend <code>WriteStream</code></h4>
<div class="paragraph">
<p>The <code>MessageProducer</code> interface does not extend the <code>WriteStream</code> interface.</p>
</div>
<div class="paragraph">
<p>In the previous releases of Vert.x, the <code>MessageProducer</code> interface extended the <code>WriteStream</code> interface. The <code>MessageProducer</code> interface provided limited support for message back-pressure. Credit leaks would result in a reduction of credits in the message producer. If these leaks used all the credits, messages would not be sent.</p>
</div>
<div class="paragraph">
<p>However, <code>MessageConsumer</code> will continue to extend <code>ReadStream</code>. When <code>MessageConsumer</code> is paused and the pending message queue is full, the messages are dropped. This continues the integration with Rx generators to build message consuming pipelines.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_send_methods_from_code_messageproducer_code">Removed the send methods from <code>MessageProducer</code></h4>
<div class="paragraph">
<p>The send methods in the <code>MessageProducer</code> interface have been removed.</p>
</div>
<div class="paragraph">
<p>Use the methods <code>MessageProducer&lt;T&gt;.write(T)</code> instead of <code>MessageProducer&lt;T&gt;.send(T)</code> and <code>EventBus.request(String,Object,Handler)</code> instead of <code>MessageProducer.send(T,Handler)</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-eventbus_changes-in-common-components">Changes in EventBus</h3>
<div class="paragraph">
<p>The following section describes the changes in EventBus.</p>
</div>
<div class="sect3">
<h4 id="_removed_the_request_response_send_methods_in_eventbus">Removed the request-response send methods in EventBus</h4>
<div class="paragraph">
<p>The <code>EventBus.send(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> and <code>Message.reply(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> methods have been removed. These methods would have caused overloading issues in Vert.x 4. The version of the method returning <code>Future&lt;Message&lt;T&gt;&gt;</code> would collide with the fire and forget version.</p>
</div>
<div class="paragraph">
<p>The request-response messaging pattern should use the new <code>request</code> and <code>replyAndRequest</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the method <code>EventBus.request(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> instead of <code>EventBus.send(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> to send a message.</p>
</li>
<li>
<p>Use the method <code>Message.replyAndRequest(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> instead of <code>Message.reply(&#8230;&#8203;, Handler&lt;AsyncResult&lt;Message&lt;T&gt;&gt;&gt;)</code> to reply to the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows the request and reply to a message in Vert.x 3.x releases.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Request</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>eventBus.send("the-address", body, ar -&gt; ...);</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Reply</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>eventBus.consumer("the-address", message -&gt; {
       message.reply(body, ar -&gt; ...);
});</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the request and reply to a message in Vert.x 4.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Request</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>eventBus.request("the-address", body, ar -&gt; ...);</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Reply</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>eventBus.consumer("the-address", message -&gt; {
  message.replyAndRequest(body, ar -&gt; ...);
});</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-handlers_changes-in-common-components">Changes in future</h3>
<div class="paragraph">
<p>This section explains the changes in future.</p>
</div>
<div class="sect3">
<h4 id="_support_for_multiple_handlers_for_futures">Support for multiple handlers for futures</h4>
<div class="paragraph">
<p>From Vert.x 4 onward, multiple handlers are supported for a future. The <code>Future&lt;T&gt;.setHandler()</code> method used to set a single handler and has been removed. Use <code>Future&lt;T&gt;.onComplete()</code>, <code>Future&lt;T&gt;.onSuccess()</code>, and <code>Future&lt;T&gt;.onFailure()</code> methods instead to call handlers on completion, success, and failure results of an action.</p>
</div>
<div class="paragraph">
<p>The following example shows how to call a handler in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Future&lt;String&gt; fut = getSomeFuture();
fut.setHandler(ar -&gt; ...);</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to call the new <code>Future&lt;T&gt;.onComplete()</code> method in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Future&lt;String&gt; fut = getSomeFuture();
fut.onComplete(ar -&gt; ...);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_code_completer_code_method_in_future">Removed the <code>completer()</code> method in future</h4>
<div class="paragraph">
<p>In earlier releases of Vert.x, you would use the <code>Future.completer()</code> method to access <code>Handler&lt;AsyncResult&lt;T&gt;&gt;</code>, which was associated with the <code>Future</code>.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the <code>Future&lt;T&gt;.completer()</code> method has been removed. <code>Future&lt;T&gt;</code> directly extends <code>Handler&lt;AsyncResult&lt;T&gt;&gt;</code>. You can access all the handler methods using the <code>Future</code> object. The <code>Future</code> object is also a handler.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_connection_handler_method_in_http_client_request">Removed the connection handler method in HTTP client request</h4>
<div class="paragraph">
<p>The <code>HttpClientRequest.connectionHandler()</code> method has been removed. Use <code>HttpClient.connectionHandler()</code> method instead to call connection handlers for client requests in your application.</p>
</div>
<div class="paragraph">
<p>The following example shows how the <code>HttpClientRequest.connectionHandler()</code> method was used in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.request().connectionHandler(conn -&gt; {
  // Connection related code
}).end();</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you how to use the new <code>HttpClient.connectionHandler()</code> method in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.connectionHandler(conn -&gt; {
  // Connection related code
});</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-verticles_changes-in-common-components">Changes in verticles</h3>
<div class="paragraph">
<p>This section explains the changes in the verticles.</p>
</div>
<div class="sect3">
<h4 id="_updates_in_the_create_verticle_method">Updates in the create verticle method</h4>
<div class="paragraph">
<p>In earlier releases of Vert.x, <code>VerticleFactory.createVerticle()</code> method synchronously instantiated a verticle. From Vert.x 4 onward, the method asynchronously instantiates the verticle and returns the callback <code>Callable&lt;Verticle&gt;</code> instead of the single verticle instance. This improvement enables the application to call this method once and invoke the returned callable multiple times for creating multiple instances.</p>
</div>
<div class="paragraph">
<p>The following code shows how verticles were instantiated in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Verticle createVerticle(String verticleName, ClassLoader classLoader) throws Exception;</pre>
</div>
</div>
<div class="paragraph">
<p>The following code shows how verticles are instantiated in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>void createVerticle(String verticleName, ClassLoader classLoader, Promise&lt;Callable&lt;Verticle&gt;&gt; promise);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updates_in_the_factory_class_and_methods">Updates in the factory class and methods</h4>
<div class="paragraph">
<p>The <code>VerticleFactory</code> class has been simplified. The class does not require initial resolution of an identifier because the factory can instead use nested deployment to deploy the verticle.</p>
</div>
<div class="paragraph">
<p>If your existing applications use factories, in Vert.x 4 you can update the code to use a callable when a promise completes or fails. The callable can be called several times.</p>
</div>
<div class="paragraph">
<p>The following example shows existing factories in an Vert.x 3.x application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>return new MyVerticle();</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to update existing factories to use promise in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>promise.complete(() -&gt; new MyVerticle());</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>Vertx.executeBlocking()</code> method, if you want the factory to block code. When the factory receives the blocking code, it should resolve the promise and get the verticle instances from the promise.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_multithreaded_worker_verticles">Removed the multithreaded worker verticles</h4>
<div class="paragraph">
<p>Multi-threaded worker verticle deployment option has been removed. This feature could only be used with Vert.x event-bus. Other Vert.x components such as HTTP did not support the feature.</p>
</div>
<div class="paragraph">
<p>Use the unordered <code>Vertx.executeBlocking()</code> method to achieve the same functionality as multi-threaded worker deployment.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-threads_changes-in-common-components">Changes in threads</h3>
<div class="paragraph">
<p>This section explains the changes in threads.</p>
</div>
<div class="sect3">
<h4 id="_context_affinity_for_non_vert_x_thread">Context affinity for non Vert.x thread</h4>
<div class="paragraph">
<p>The <code>Vertx.getOrCreateContext()</code> method creates a single context for each non Vert.x thread. The non Vert.x threads are associated with a context the first time a context is created. In earlier releases, a new context was created each time the method was called from a non Vert.x thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> <span class="predefined-type">Thread</span>(() -&gt; {
  assertSame(vertx.getOrCreateContext(), vertx.getOrCreateContext());
}).start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This change does not affect your applications, unless your application implicitly relies on a new context to be created with each invocation.</p>
</div>
<div class="paragraph">
<p>In the following example the n blocks run concurrently as each blocking code is called on a different context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>;i &lt; n;i++) {
  vertx.executeBlocking(block, handler);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the same results in Vert.x 4, you must update the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>;i &lt; n;i++) {
  vertx.executeBlocking(block, <span class="predefined-constant">false</span>, handler);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-http_changes-in-common-components">Changes in HTTP</h3>
<div class="paragraph">
<p>This section explains the changes in HTTP methods.</p>
</div>
<div class="sect3">
<h4 id="con_mg_generic-updates-in-vertx-http_changes-in-http">Generic updates in Vert.x HTTP methods</h4>
<div class="paragraph">
<p>The following section describes the miscellaneous updates in Vert.x HTTP methods.</p>
</div>
<div class="sect4">
<h5 id="_updates_in_http_methods_for_code_websocket_code">Updates in HTTP Methods for <code>WebSocket</code></h5>
<div class="paragraph">
<p>The changes in <code>WebSocket</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The usage of the term <code>WebSocket</code> in method names was inconsistent. The method names had incorrect capitalization, for example, <code>Websocket</code>, instead of <code>WebSocket</code>. The methods that had inconsistent usage of <code>WebSocket</code> in the following classes have been removed. Use the new methods that have correct capitalization instead.</p>
<div class="ulist">
<ul>
<li>
<p>The following methods in <code>HttpServerOptions</code> class have been removed.</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed methods</th>
<th class="tableblock halign-left valign-top">New methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMaxWebsocketFrameSize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMaxWebSocketFrameSize()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setMaxWebsocketFrameSize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setMaxWebSocketFrameSize()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMaxWebsocketMessageSize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMaxWebSocketMessageSize()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setMaxWebsocketMessageSize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setMaxWebSocketMessageSize()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getPerFrameWebsocketCompressionSupported()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getPerFrameWebSocketCompressionSupported()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPerFrameWebsocketCompressionSupported()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPerFrameWebSocketCompressionSupported()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getPerMessageWebsocketCompressionSupported()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getPerMessageWebSocketCompressionSupported()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPerMessageWebsocketCompressionSupported()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPerMessageWebSocketCompressionSupported()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketAllowServerNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketAllowServerNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketAllowServerNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketAllowServerNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketCompressionLevel()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketCompressionLevel()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketCompressionLevel()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketCompressionLevel()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketPreferredClientNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketPreferredClientNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketPreferredClientNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketPreferredClientNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketSubProtocols()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketSubProtocols()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketSubProtocols()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketSubProtocols()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The new methods for <code>WebSocket</code> subprotocols use <code>List&lt;String&gt;</code> data type instead of a comma separated string to store items.</p>
</div>
</li>
<li>
<p>The following methods in <code>HttpClientOptions</code> class have been removed.</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed Methods</th>
<th class="tableblock halign-left valign-top">Replacing Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTryUsePerMessageWebsocketCompression()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTryUsePerMessageWebSocketCompression()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setTryUsePerMessageWebsocketCompression()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setTryUsePerMessageWebSocketCompression()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTryWebsocketDeflateFrameCompression()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTryWebSocketDeflateFrameCompression()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketCompressionAllowClientNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketCompressionAllowClientNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketCompressionAllowClientNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketCompressionAllowClientNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketCompressionLevel()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketCompressionLevel()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketCompressionLevel()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketCompressionLevel()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebsocketCompressionRequestServerNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getWebSocketCompressionRequestServerNoContext()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebsocketCompressionRequestServerNoContext()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setWebSocketCompressionRequestServerNoContext()</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The following handler methods in <code>HttpServer</code> class have been removed.</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Methods</th>
<th class="tableblock halign-left valign-top">New Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websocketHandler()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>webSocketHandler()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websocketStream()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>webSocketStream()</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
<li>
<p><code>WebsocketRejectedException</code> is deprecated. The methods throw <code>UpgradeRejectedException</code> instead.</p>
</li>
<li>
<p>The <code>HttpClient</code> <code>webSocket()</code> methods use  <code>Handler&lt;AsyncResult&lt;WebSocket&gt;&gt;</code> instead of <code>Handler</code> or <code>Handler&lt;Throwable&gt;</code>.</p>
</li>
<li>
<p>The number of overloaded methods to connect an HTTP client to a WebSocket has also been reduced by using the methods in <code>WebSocketConnectOptions</code> class.</p>
</li>
<li>
<p>The <code>HttpServerRequest.upgrade()</code> method has been removed. This method was synchronous.</p>
<div class="paragraph">
<p>Use the new method <code>HttpServerRequest.toWebSocket()</code> instead. This new method is asynchronous.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of synchronous method in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// 3.x
server.requestHandler(req -&gt; {
  WebSocket ws = req.upgrade();
});</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the use of asynchronous method in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// 4.0
server.requestHandler(req -&gt; {
  Future&lt;WebSocket&gt; fut = req.toWebSocket();
  fut.onSuccess(ws -&gt; {
  });
});</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_setting_the_number_of_websocket_connections">Setting the number of WebSocket connections</h5>
<div class="paragraph">
<p>In Vert.x 3.x, you could use the the HTTP client pool size to define the maximum number of WebSocket connections in an application. The value accessor methods <code>HttpClientOptions.maxPoolSize()</code> were used to get and set the WebSocket connections. The default number of connections was set to 4 for each endpoint.</p>
</div>
<div class="paragraph">
<p>The following example shows how WebSocket connections are set in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// 3.x
options.setMaxPoolSize(30); // Maximum connection is set to 30 for each endpoint</pre>
</div>
</div>
<div class="paragraph">
<p>However, in Vert.x 4, there is no pooling of WebSocket TCP connections, because the connections are closed after use. The applications use a different pool for HTTP requests. Use the value accessor methods <code>HttpClientOptions.maxWebSockets()</code> to get and set the WebSocket connections. The default number of connections is set to 50 for each endpoint.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set WebSocket connections in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// 4.0
options.setMaxWebSockets(30); // Maximum connection is set to 30 for each endpoint</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_httpmethod_code_is_available_as_a_interface"><code>HttpMethod</code> is available as a interface</h5>
<div class="paragraph">
<p><code>HttpMethod</code> is available as a new interface.</p>
</div>
<div class="paragraph">
<p>In earlier releases of Vert.x, <code>HttpMethod</code> was declared as an enumerated data type. As an enumeration, it limited the extensibility of HTTP. Further, it prevented serving other HTTP methods with this type directly. You had to use the  <code>HttpMethod.OTHER</code> value along with the <code>rawMethod</code> attribute during server and client HTTP requests.</p>
</div>
<div class="paragraph">
<p>If you are using <code>HttpMethod</code> enumerated data type in a switch block, you can use the following code to migrate your applications to Vert.x 4.</p>
</div>
<div class="paragraph">
<p>The following example shows a switch block in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">switch (method) {
  case GET:
    ...
    break;
  case OTHER:
    String s = request.getRawMethod();
    if (s.equals("PROPFIND") {
      ...
    } else ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a switch block in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">switch (method.name()) {
  case "GET":
    ...
    break;
  case "PROPFIND";
    ...
    break;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the following code in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HttpMethod PROPFIND = HttpMethod.valueOf("PROPFIND");

if (method == HttpMethod.GET) {
  ...
} else if (method.equals(PROPFIND)) {
  ...
} else {
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>If you are using <code>HttpMethod.OTHER</code> value in your applications, use the following code to migrate the application to Vert.x 4.</p>
</div>
<div class="paragraph">
<p>The following example shows you the code in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.request(HttpMethod.OTHER, ...).setRawName("PROPFIND");</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you the code in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.request(HttpMethod.valueOf("PROPFIND"), ...);</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes-in-http-client_changes-in-http">Changes in HTTP client</h4>
<div class="paragraph">
<p>This section describes the changes in HTTP client.</p>
</div>
<div class="paragraph">
<p>The following types of Vert.x clients are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Vert.x web client</dt>
<dd>
<p>Use the Vert.x web client when your applications are web oriented. For example, REST, encoding and decoding HTTP payloads, interpreting the HTTP status response code, and so on.</p>
</dd>
<dt class="hdlist1">Vert.x HTTP client</dt>
<dd>
<p>Use the Vert.x HTTP client when your applications are used as HTTP proxy. For example, as an API gateway. The HTTP client has been updated and improved in Vert.x 4.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Vert.x web client is based on Vert.x HTTP client.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="migrating-applications-to-vertx-web-client_changes-in-http-client">Migrating applications to Vert.x web client</h5>
<div class="paragraph">
<p>The web client was available from Vert.x 3.4.0 release. There is no change in the web client in Vert.x 4.</p>
</div>
<div class="paragraph">
<p>The client provides simplified HTTP interactions and some additional features, such as HTTP session, JSON encoding and decoding, response predicates, which are not available in the Vert.x HTTP Client.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use HTTP client in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">HttpClientRequest request = client.get(<span class="integer">80</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, response -&gt; {
  <span class="type">int</span> statusCode = response.statusCode();
  response.exceptionHandler(err -&gt; {
    <span class="comment">// Handle connection error, for example, connection closed</span>
  });
  response.bodyHandler(body -&gt; {
    <span class="comment">// Handle body entirely</span>
  });
});
request.exceptionHandler(err -&gt; {
  <span class="comment">// Handle connection error OR response error</span>
});
request.end();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to migrate an application to web client in Vert.x 3.x and Vert.x 4 releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.get(<span class="integer">80</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/some-uri</span><span class="delimiter">&quot;</span></span>)
  .send(ar -&gt; {
    <span class="keyword">if</span> (ar.suceeded()) {
      HttpResponse&lt;<span class="predefined-type">Buffer</span>&gt; response = ar.result();
      <span class="comment">// Handle response</span>
    }  <span class="keyword">else</span> {
      <span class="comment">// Handle error</span>
    }
  });</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="migrating-applications-to-vertx-http-client_changes-in-http-client">Migrating applications to Vert.x HTTP client</h5>
<div class="paragraph">
<p>The HTTP client has fine grained control over HTTP interactions and focuses on the HTTP protocol.</p>
</div>
<div class="paragraph">
<p>The HTTP client has been updated and improved in Vert.x 4:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simplified APIs with fewer interactions</p>
</li>
<li>
<p>Robust error handling</p>
</li>
<li>
<p>Support for connection reset for HTTP/1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The updates in HTTP client APIs are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The methods in <code>HttpClientRequest</code> such as, <code>get()</code>, <code>delete()</code>, <code>put()</code> have been removed. Use the method <code>HttpClientRequest&gt;	request(HttpMethod method, )</code> instead.</p>
</li>
<li>
<p><code>HttpClientRequest</code> instance is created when a request or response is possible. For example, an <code>HttpClientRequest</code> instance is created when the client connects to the server or a connection is reused from the pool.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_sending_a_simple_request">Sending a simple request</h6>
<div class="paragraph">
<p>The following example shows how to send a GET request in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">HttpClientRequest request = client.get(<span class="integer">80</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, response -&gt; {
  <span class="type">int</span> statusCode = response.statusCode();
  response.exceptionHandler(err -&gt; {
    <span class="comment">// Handle connection error, for example, connection closed</span>
  });
  response.bodyHandler(body -&gt; {
    <span class="comment">// Handle body entirely</span>
  });
});
request.exceptionHandler(err -&gt; {
  <span class="comment">// Handle connection error OR response error</span>
});
request.end();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to send a GET request in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request(HttpMethod.GET, <span class="integer">80</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientRequest = ar.result();
    request.send(ar2 -&gt; {
      <span class="keyword">if</span> (ar2.succeeded()) {
        HttpClientResponse = ar2.result();
        <span class="type">int</span> statusCode = response.statusCode();
        response.body(ar3 -&gt; {
          <span class="keyword">if</span> (ar3.succeeded()) {
            <span class="predefined-type">Buffer</span> body = ar3.result();
            <span class="comment">// Handle body entirely</span>
          } <span class="keyword">else</span> {
            <span class="comment">// Handle server error, for example, connection closed</span>
          }
        });
      } <span class="keyword">else</span> {
        <span class="comment">// Handle server error, for example, connection closed</span>
      }
    });
  } <span class="keyword">else</span> {
    <span class="comment">// Connection error, for example, invalid server or invalid SSL certificate</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that error handling is better in the new HTTP client.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use future composition in a GET operation in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">Future</span>&lt;<span class="predefined-type">Buffer</span>&gt; fut = client.request(HttpMethod.GET, <span class="integer">80</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
  .compose(request -&gt; request.send().compose(response -&gt; {
    <span class="type">int</span> statusCode = response.statusCode();
    <span class="keyword">if</span> (statusCode == <span class="integer">200</span>) {
      <span class="keyword">return</span> response.body();
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="predefined-type">Future</span>.failedFuture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unexpectd status code</span><span class="delimiter">&quot;</span></span>);
    }
  })
});
fut.onComplete(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    <span class="predefined-type">Buffer</span> body = ar.result();
    <span class="comment">// Handle body entirely</span>
  } <span class="keyword">else</span> {
    <span class="comment">// Handle error</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Future composition improves exception handling. The example checks if the status code is 200, otherwise it returns an error.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When you use the HTTP client with futures, the <code>HttpClientResponse()</code> method starts emitting buffers as soon as it receives a response. To avoid this, ensure that the future composition occurs either on the event-loop (as shown in the example) or it should pause and resume the response.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sending_requests">Sending requests</h6>
<div class="paragraph">
<p>In Vert.x 3.x releases, you could use the <code>end()</code> method to send requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>request.end();</pre>
</div>
</div>
<div class="paragraph">
<p>You could also send a body in the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>request.end(Buffer.buffer("hello world));</pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>HttpClientRequest</code> is a <code>Writestream&lt;Buffer&gt;</code>, you could also use a pipe to stream the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">writeStream.pipeTo(request, ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    <span class="comment">// Sent the stream</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, you can perform all the operations shown in the examples using the <code>get()</code> method. You can also use the new <code>send()</code> method to perform these operations. You can pass a buffer, a string, or a <code>ReadStream</code> as input to the <code>send()</code> method. The method returns an <code>HttpClientResponse</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Send a request and process the response</span>
request.onComplete(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientResponse response = ar.result();
    <span class="comment">// Handle the response</span>
  }
})
request.end();

<span class="comment">// The new send method combines all the operations</span>
request.send(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientResponse response = ar.result();
    <span class="comment">// Handle the response</span>
  }
}));</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_handling_responses">Handling responses</h6>
<div class="paragraph">
<p>The <code>HttpClientResponse</code> interface has been updated and improved with the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>body()</code> method</dt>
<dd>
<p>The <code>body()</code> method returns an asynchronous buffer. Use the <code>body()</code> method instead of <code>bodyHandler()</code>.</p>
<div class="paragraph">
<p>The following example shows how to use the <code>bodyHandler()</code> method to get the request body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">response.bodyHandler(body -&gt; {
  <span class="comment">// Process the request body</span>
});
response.exceptionHandler(err -&gt; {
  <span class="comment">// Could not get the request body</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use the <code>body()</code> method to get the request body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">response.body(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    <span class="comment">// Process the request body</span>
  } <span class="keyword">else</span> {
    <span class="comment">// Could not get the request body</span>
  }
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>end()</code> method</dt>
<dd>
<p>The <code>end()</code> method returns a future when a response is fully received successfully or failed. The method removes the response body. Use this method instead of <code>endHandler()</code> method.</p>
<div class="paragraph">
<p>The following example shows how to use the <code>endHandler()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">response.endHandler(v -&gt; {
  <span class="comment">// Response ended</span>
});
response.exceptionHandler(err -&gt; {
  <span class="comment">// Response failed, something went wrong</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use the <code>end()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">response.end(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    <span class="comment">// Response ended</span>
  } <span class="keyword">else</span> {
    <span class="comment">// Response failed, something went wrong</span>
  }
});</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also handle the response with methods such as, <code>onSucces()</code>, <code>compose()</code>, <code>bodyHandler()</code> and so on. The following examples demonstrate handling responses using the <code>onSuccess()</code> method.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use HTTP client with the <code>result()</code> method in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">HttpClient client = vertx.createHttpClient(options);

    client.request(HttpMethod.GET, <span class="integer">8443</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
      .onSuccess(request -&gt; {
        request.onSuccess(resp -&gt; {

        <span class="comment">//Code to handle HTTP response</span>
        });
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use HTTP client with the <code>result()</code> method in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">HttpClient client = vertx.createHttpClient(options);

    client.request(HttpMethod.GET, <span class="integer">8443</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
      .onSuccess(request -&gt; {
        request.response().onSuccess(resp -&gt; {

        <span class="comment">//Code to handle HTTP response</span>
        });
      });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="improvements-in-vertx-http-client_changes-in-http-client">Improvements in the Vert.x HTTP client</h5>
<div class="paragraph">
<p>This section describes the improvements in HTTP client.</p>
</div>
<div class="sect5">
<h6 id="_http_client_request_and_response_methods_take_an_asynchronous_handler_as_input_argument">HTTP client request and response methods take an asynchronous handler as input argument</h6>
<div class="paragraph">
<p>The <code>HttpClient</code> and <code>HttpClientRequest</code> methods have been updated to use asynchronous handlers. The methods take <code>Handler&lt;AsyncResult&lt;HttpClientResponse&gt;&gt;</code> as input instead of <code>Handler&lt;HttpClientResponse&gt;</code>.</p>
</div>
<div class="paragraph">
<p>In earlier releases of Vert.x, the <code>HttpClient</code> methods <code>getNow()</code>, <code>optionsNow()</code> and <code>headNow()</code> used to return <code>HttpClientRequest</code>, that you had to further send to perform a request. The <code>getNow()</code>, <code>optionsNow()</code> and <code>headNow()</code> methods have been removed. In Vert.x 4, you can directly send a request with the required information using <code>Handler&lt;AsyncResult&lt;HttpClientResponse&gt;&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The following examples show how to send a request in Vert.x 3.x.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To perform a GET operation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">Future</span>&lt;HttpClientResponse&gt; f1 = client.get(<span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/uri</span><span class="delimiter">&quot;</span></span>, HttpHeaders.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</li>
<li>
<p>To POST with a buffer body:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">Future</span>&lt;HttpClientResponse&gt; f2 = client.post(<span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/uri</span><span class="delimiter">&quot;</span></span>, HttpHeaders.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">Buffer</span>.buffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">some-data</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</li>
<li>
<p>To POST with a streaming body:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">Future</span>&lt;HttpClientResponse&gt; f3 = client.post(<span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/uri</span><span class="delimiter">&quot;</span></span>, HttpHeaders.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>), asyncFile);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Vert.x 4, you can use the <code>requests</code> methods to create an <code>HttpClientRequest</code> instance. These methods can be used in basic interactions such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sending the request headers</p>
</li>
<li>
<p>HTTP/2 specific operations such as setting a push handler, setting stream priority, pings, and so on.</p>
</li>
<li>
<p>Creating a NetSocket tunnel</p>
</li>
<li>
<p>Providing fine grained write control</p>
</li>
<li>
<p>Resetting a stream</p>
</li>
<li>
<p>Handling 100 continue headers manually</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows you how to create an <code>HTTPClientRequest</code> in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request(HttpMethod.GET, <span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/resource</span><span class="delimiter">&quot;</span></span>, ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientRequest request = ar.result();
    request.putHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">content-type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
    request.send(<span class="keyword">new</span> JsonObject().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>))
      .onSuccess(response -&gt; {
      <span class="comment">//</span>
      }).onFailure(err -&gt; {
      <span class="comment">//</span>
       });
     }
})</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_removed_the_connection_handler_method_from_http_client_request">Removed the connection handler method from HTTP client request</h6>
<div class="paragraph">
<p>The <code>HttpClientRequest.connectionHandler()</code> method has been removed. Use <code>HttpClient.connectionHandler()</code> method instead to call connection handlers for client requests in your application.</p>
</div>
<div class="paragraph">
<p>The following example shows how the <code>HttpClientRequest.connectionHandler()</code> method was used in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request().connectionHandler(conn -&gt; {
  <span class="comment">// Connection related code</span>
}).end();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you how to use the new <code>HttpClient.connectionHandler()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.connectionHandler(conn -&gt; {
<span class="comment">// Connection related code</span>
});</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_http_client_tunneling_using_the_net_socket_method">HTTP client tunneling using the net socket method</h6>
<div class="paragraph">
<p>HTTP tunnels can be created using the <code>HttpClientResponse.netSocket()</code> method. In Vert.x 4 this method has been updated.</p>
</div>
<div class="paragraph">
<p>To get a net socket for the connection of the request, send a socket handler in the request. The handler is called when the HTTP response header is received. The socket is ready for tunneling and can send and receive buffers.</p>
</div>
<div class="paragraph">
<p>The following example shows how to get net socket for a connection in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request(HttpMethod.CONNECT, uri, ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientResponse response = ar.result();
    <span class="keyword">if</span> (response.statusCode() == <span class="integer">200</span>) {
      NetSocket so = response.netSocket();
   }
  }
}).end();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to get net socket for a connection in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request(HttpMethod.CONNECT, uri, ar -&gt; {
}).netSocket(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
   <span class="comment">// Got a response with a 200 status code</span>
   NetSocket so = ar.result();
   <span class="comment">// Go for tunneling</span>
  }
}).end();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_new_code_send_code_method_in_code_httpclient_code_class">New <code>send()</code> method in <code>HttpClient</code> class</h6>
<div class="paragraph">
<p>A new <code>send()</code> method is available in the <code>HttpClient</code> class.</p>
</div>
<div class="paragraph">
<p>The following code shows how to send a request in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Future&lt;HttpClientResponse&gt; f1 = client.send(HttpMethod.GET, 8080, "localhost", "/uri", HttpHeaders.set("foo", "bar"));</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_httpheaders_is_an_interface_and_contains_code_multimap_code_methods">HttpHeaders is an interface and contains <code>MultiMap</code> methods</h6>
<div class="paragraph">
<p>In Vert.x 4, <code>HttpHeaders</code> is an interface. In earlier releases of Vert.x,  <code>HttpHeaders</code> was a class.</p>
</div>
<div class="paragraph">
<p>The following new <code>MultiMap</code> methods have been added in the <code>HttpHeaders</code> interface. Use these methods to create <code>MultiMap</code> instances.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MultiMap.headers()</code></p>
</li>
<li>
<p><code>MultiMap.set(CharSequence name, CharSequence value)</code></p>
</li>
<li>
<p><code>MultiMap.set(String name, String value)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how <code>MultiMap</code> instances were created in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MultiMap headers = MultiMap.caseInsensitiveMultiMap();</pre>
</div>
</div>
<div class="paragraph">
<p>The following examples show how to create <code>MultiMap</code> instances in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MultiMap headers = HttpHeaders.headers();</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>MultiMap headers = HttpHeaders.set("content-type", "application.data");</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_code_caseinsensitiveheaders_code_class_is_no_longer_public"><code>CaseInsensitiveHeaders</code> class is no longer public</h6>
<div class="paragraph">
<p>The <code>CaseInsensitiveHeaders</code> class is no longer public. Use the <code>MultiMap.caseInsensitiveMultiMap()</code> method to create a multi-map implementation with case insensitive keys.</p>
</div>
<div class="paragraph">
<p>The following example shows how <code>CaseInsensitiveHeaders</code> method was used in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CaseInsensitiveHeaders headers = new CaseInsensitiveHeaders();</pre>
</div>
</div>
<div class="paragraph">
<p>The following examples show how <code>MultiMap</code> method is used in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MultiMap multiMap = MultiMap#caseInsensitiveMultiMap();</pre>
</div>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MultiMap headers = HttpHeaders.headers();</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_checking_the_version_of_http_running_on_the_server">Checking the version of HTTP running on the server</h6>
<div class="paragraph">
<p>In earlier releases of Vert.x, the version of HTTP running on a server was checked only if the application explicitly called the <code>HttpServerRequest.version()</code> method. If the HTTP version was HTTP/1.x, the method would return the 501 HTTP status, and close the connection.</p>
</div>
<div class="paragraph">
<p>From Vert.x 4 onward, before a request is sent to the server, the HTTP version on the server is automatically checked by calling the <code>HttpServerRequest.version()</code> method. The method returns the HTTP version instead of throwing an exception when an invalid HTTP version is found.</p>
</div>
</div>
<div class="sect5">
<h6 id="_new_methods_in_request_options">New methods in request options</h6>
<div class="paragraph">
<p>In Vert.x 4, the following new methods are available in the <code>RequestOptions</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Header</p>
</li>
<li>
<p>FollowRedirects</p>
</li>
<li>
<p>Timeout</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to use the new methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.request(HttpMethod.GET, <span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/resource</span><span class="delimiter">&quot;</span></span>, ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    HttpClientRequest request = ar.result();
    request.putHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">content-type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
    request.send(<span class="keyword">new</span> JsonObject().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>))
      .onSuccess(response -&gt; {
      <span class="comment">//</span>
      }).onFailure(err -&gt; {
      <span class="comment">//</span>
       });
     }
})</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-connection_changes-in-common-components">Changes in connection methods</h3>
<div class="paragraph">
<p>This section explains the changes in connection methods.</p>
</div>
<div class="sect3">
<h4 id="_checking_if_authentication_is_required_for_client">Checking if authentication is required for client</h4>
<div class="paragraph">
<p>The <code>NetServerOptions.isClientAuthRequired()</code> method has been removed. Use the <code>getClientAuth() == ClientAuth.REQUIRED</code> enumerated type to check if client authentication is required.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use a switch statement to check if authentication of the client is required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>switch (options.getClientAuth()) {
case REQUIRED:
// ... behavior same as in releases prior to {VertX} {v4}
break;
default:
// fallback statement...
}</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use the check if authentication of the client is required in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if (options.getClientAuth() == ClientAuth.REQUIRED) {
// behavior in releases prior to {VertX} {v4}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_upgrade_ssl_method_uses_asynchronous_handler">Upgrade SSL method uses asynchronous handler</h4>
<div class="paragraph">
<p>The <code>NetSocket.upgradeToSsl()</code> method has been updated to use <code>Handler&lt;AsyncResult&gt;</code> instead of <code>Handler</code>. The handler is used to check if the channel has been successfully upgraded to SSL or TLS.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-logging_changes-in-common-components">Changes in logging</h3>
<div class="paragraph">
<p>This section explains the changes in logging.</p>
</div>
<div class="sect3">
<h4 id="_deprecated_logging_classes_and_methods">Deprecated logging classes and methods</h4>
<div class="paragraph">
<p>The logging classes <code>Logger</code> and <code>LoggerFactory</code> along with their methods have been deprecated. These logging classes and methods will be removed in a future release.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_log4j_1_logger">Removed Log4j 1 logger</h4>
<div class="paragraph">
<p>The <code>Log4j 1</code> logger is no longer available. However, if you want to use <code>Log4j 1</code> logger, it is available with <code>SLF4J</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-reactive-extensions_changes-in-common-components">Changes in Vert.x Reactive Extensions (Rx)</h3>
<div class="paragraph">
<p>This section describes the changes in Reactive Extensions (Rx) in Vert.x. Vert.x uses the RxJava library.</p>
</div>
<div class="sect3">
<h4 id="_support_for_rxjava_3">Support for RxJava 3</h4>
<div class="paragraph">
<p>From Vert.x 4.1.0, RxJava 3 is supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new rxified API is available in the <code>io.vertx.rxjava3</code> package.</p>
</li>
<li>
<p>Integration with Vert.x JUnit5 is provided by the <code>vertx-junit5-rx-java3</code> binding.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To upgrade to RxJava 3, you must make the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <code>pom.xml</code> file, under <code>&lt;dependency&gt;</code> change the RxJava 1 and 2 bindings from <code>vertx-rx-java</code> or <code>vertx-rx-java2</code> to <code>vertx-rx-java3</code>.</p>
</li>
<li>
<p>In your application, update the imports from <code>io.vertx.reactivex.*</code> to <code>io.vertx.rxjava3.*</code>.</p>
</li>
<li>
<p>In your application, update the imports for RxJava 3 types also. For more information, see <em>Whats new</em> section in RxJava 3 documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_removed_code_oncomplete_code_callback_from_write_stream">Removed <code>onComplete</code> callback from write stream</h4>
<div class="paragraph">
<p>The <code>WriteStreamSubscriber.onComplete()</code> callback has been removed. This callback was invoked if <code>WriteStream</code> had pending streams of data to be written.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, use the callbacks <code>WriteStreamSubscriber.onWriteStreamEnd()</code> and <code>WriteStreamSubscriber.onWriteStreamError()</code> instead. These callbacks are called after <code>WriteStream.end()</code> is complete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">WriteStreamSubscriber&lt;<span class="predefined-type">Buffer</span>&gt; subscriber = writeStream.toSubscriber();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to create the adapter from a <code>WriteStream</code> in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">subscriber.onComplete(() -&gt; {
    <span class="comment">// Called after writeStream.end() is invoked, even if operation has not completed</span>
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following examples show how to create the adapter from a WriteStream using the new callback methods in Vert.x 4 release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">subscriber.onWriteStreamEnd(() -&gt; {
    <span class="comment">// Called after writeStream.end() is invoked and completes successfully</span>
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">subscriber.onWriteStreamError(() -&gt; {
    <span class="comment">// Called after writeStream.end() is invoked and fails</span>
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-config_changes-in-common-components">Changes in Vert.x configuration</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x configuration.</p>
</div>
<div class="sect3">
<h4 id="_new_method_to_retrieve_configuration">New method to retrieve configuration</h4>
<div class="paragraph">
<p>The method <code>ConfigRetriever.getConfigAsFuture()</code> has been removed. Use the method <code>retriever.getConfig()</code> instead.</p>
</div>
<div class="paragraph">
<p>The following example shows how configuration was retrieved in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">Future</span>&lt;JsonObject&gt; fut = ConfigRetriever. getConfigAsFuture(retriever);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to retrieve configuration in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">fut = retriever.getConfig();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-json_changes-in-common-components">Changes in JSON</h3>
<div class="paragraph">
<p>This section describes changes in JSON.</p>
</div>
<div class="sect3">
<h4 id="_encapsulation_of_jackson">Encapsulation of Jackson</h4>
<div class="paragraph">
<p>All the methods in the JSON class that implement Jackson types have been removed. Use the following methods instead:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed Fields/Methods</th>
<th class="tableblock halign-left valign-top">New methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Json.mapper()</code> field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatabindCodec.mapper()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Json.prettyMapper()</code> field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatabindCodec.prettyMapper()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Json.decodeValue(Buffer, TypeReference&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JacksonCodec.decodeValue(Buffer, TypeReference)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Json.decodeValue(String, TypeReference&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JacksonCodec.decodeValue(String, TypeReference)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, use the following code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When using Jackson <code>TypeReference</code>:</p>
<div class="ulist">
<ul>
<li>
<p>In Vert.x 3.x releases:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">List</span>&lt;Foo&gt; foo1 = Json.decodeValue(json, <span class="keyword">new</span> TypeReference&lt;<span class="predefined-type">List</span>&lt;Foo&gt;&gt;() {});</code></pre>
</div>
</div>
</li>
<li>
<p>In Vert.x 4 release:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">List</span>&lt;Foo&gt; foo2 = io.vertx.core.json.jackson.JacksonCodec.decodeValue(json, <span class="keyword">new</span> TypeReference&lt;<span class="predefined-type">List</span>&lt;Foo&gt;&gt;() {});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Referencing an <code>ObjectMapper</code>:</p>
<div class="ulist">
<ul>
<li>
<p>In Vert.x 3.x releases:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">ObjectMapper mapper = Json.mapper;</code></pre>
</div>
</div>
</li>
<li>
<p>In Vert.x 4 release:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">mapper = io.vertx.core.json.jackson.DatabindCodec.mapper();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Setting an <code>ObjectMapper</code>:</p>
<div class="ulist">
<ul>
<li>
<p>In Vert.x 3.x releases:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">Json.mapper = someMapper;</code></pre>
</div>
</div>
</li>
<li>
<p>From Vert.x 4 onward, you cannot write a mapper instance. You should use your own static mapper or configure the <code>Databind.mapper()</code> instance.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_object_mapping">Object mapping</h4>
<div class="paragraph">
<p>In earlier releases, the Jackson core and Jackson databind dependencies were required at runtime.</p>
</div>
<div class="paragraph">
<p>From Vert.x 4 onward, only the Jackson core dependency is required.</p>
</div>
<div class="paragraph">
<p>You will require the Jackson databind dependency only if you are object mapping JSON. In this case, you must explicitly add the dependency in your project descriptor in the <code>com.fasterxml.jackson.core:jackson-databind</code> jar.</p>
</div>
<div class="paragraph">
<p>The following methods are supported for the mentioned types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Methods</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>JsonObject.mapFrom(Object)</code></p>
</li>
<li>
<p><code>JsonObject.mapTo(Class)</code></p>
</li>
<li>
<p><code>Json.decodeValue(Buffer, Class)</code></p>
</li>
<li>
<p><code>Json.decodeValue(String, Class)</code></p>
</li>
<li>
<p><code>Json.encode(Object)</code></p>
</li>
<li>
<p><code>Json.encodePrettily(Object)</code></p>
</li>
<li>
<p><code>Json.encodeToBuffer(Object)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Type</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>JsonObject</code> and <code>JsonArray</code></p>
</li>
<li>
<p><code>Map</code> and <code>List</code></p>
</li>
<li>
<p><code>Number</code></p>
</li>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>Enum</code></p>
</li>
<li>
<p><code>byte[]</code> and <code>Buffer</code></p>
</li>
<li>
<p><code>Instant</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following methods are supported only with Jackson bind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonObject.mapTo(Object)</code></p>
</li>
<li>
<p><code>JsonObject.mapFrom(Object)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_base64_encoder_updated_to_base64url_for_json_objects_and_arrays">Base64 encoder updated to Base64URL for JSON objects and arrays</h4>
<div class="paragraph">
<p>The Vert.x JSON types implement RFC-7493. In earlier releases of Vert.x, the implementation incorrectly used Base64 encoder instead of Base64URL. This has been fixed in Vert.x 4, and Base64URL encoder is used in the JSON types.</p>
</div>
<div class="paragraph">
<p>If you want to continue using the Base64 encoder in Vert.x 4, you can use the configuration flag <code>legacy</code>. The following example shows how to set the configuration flag in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">java -Dvertx.json.base64=legacy ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>During your migration from Vert.x 3.x and Vert.x 4 if you have partially migrated your applications, then you
will have applications on both version 3 and 4. In such cases where you have two versions of Vert.x you can use the
following utility to convert the Base64 string to Base64URL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> toBase64(<span class="predefined-type">String</span> base64Url) {
  <span class="keyword">return</span> base64Url
    .replace(<span class="string"><span class="delimiter">'</span><span class="content">+</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>)
    .replace(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">_</span><span class="delimiter">'</span></span>);
}

<span class="directive">public</span> <span class="predefined-type">String</span> toBase64Url(<span class="predefined-type">String</span> base64) {
  <span class="keyword">return</span> base64
    .replace(<span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">+</span><span class="delimiter">'</span></span>)
    .replace(<span class="string"><span class="delimiter">'</span><span class="content">_</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must use the utility methods in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling integration while migrating from Vert.x 3.x releases to Vert.x 4.</p>
</li>
<li>
<p>Handling interoperability with other systems that use Base64 strings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the following example code to convert a Base64URL to Base64 encoder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="predefined-type">String</span> base64url = someJsonObject.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">base64encodedElement</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> base64 = toBase64(base64url);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The helper functions {toBase64} and {toBase64Url} enable only JSON migrations. If you use object mapping to
automatically map JSON objects to a {Java} POJO in your applications, then you must create a custom object mapper to
convert the Base64 string to Base64URL.</p>
</div>
<div class="paragraph">
<p>The following example shows you how to create a object mapper with custom Base64 decoder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// simple deserializer from Base64 to byte[]</span>
<span class="type">class</span> <span class="class">ByteArrayDeserializer</span> <span class="directive">extends</span> JsonDeserializer&lt;<span class="type">byte</span><span class="type">[]</span>&gt; {
  ByteArrayDeserializer() {
  }

  <span class="directive">public</span> <span class="type">byte</span><span class="type">[]</span> deserialize(JsonParser p, DeserializationContext ctxt) {
    <span class="predefined-type">String</span> text = p.getText();
    <span class="keyword">return</span> Base64.getDecoder()
      .decode(text);
  }
}

<span class="comment">// ...</span>

ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();

<span class="comment">// create a custom module to address the Base64 decoding</span>
SimpleModule module = <span class="keyword">new</span> SimpleModule();
module.addDeserializer(<span class="type">byte</span><span class="type">[]</span>.class, <span class="keyword">new</span> ByteArrayDeserializer());
mapper.registerModule(module);

<span class="comment">// JSON to POJO with custom deserializer</span>
mapper.readValue(json, MyClass.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_json_converter_method_from_trust_options">Removed the JSON converter method from trust options</h4>
<div class="paragraph">
<p>The <code>TrustOptions.toJSON</code> method has been removed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-webchanges-in-common-components">Changes in Vert.x web</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x web.</p>
</div>
<div class="sect3">
<h4 id="_combined_the_functionality_of_user_session_handler_in_session_handler">Combined the functionality of user session handler in session handler</h4>
<div class="paragraph">
<p>In earlier releases of Vert.x, you had to specify both the <code>UserSessionHandler</code> and <code>SessionHandler</code> handlers when working in a session.</p>
</div>
<div class="paragraph">
<p>To simplify the process, in Vert.x 4, the <code>UserSessionHandler</code> class has been removed and its functionality has been added in the <code>SessionHandler</code> class. In Vert.x 4, to work with sessions you must specify only one handler.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_cookie_interfaces">Removed the cookie interfaces</h4>
<div class="paragraph">
<p>The following cookie interfaces have been removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.vertx.ext.web.Cookie</code></p>
</li>
<li>
<p><code>io.vertx.ext.web.handler.CookieHandler</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the <code>io.vertx.core.http.Cookie</code> interface instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_favicon_and_error_handlers_use_code_vertx_code_file_system">Favicon and error handlers use <code>Vertx</code> file system</h4>
<div class="paragraph">
<p>The create methods in <code>FaviconHandler</code> and <code>ErrorHandler</code> have been updated. You must pass a <code>Vertx</code> instance object in the create methods. These methods access file system. Passing the <code>Vertx</code> object ensures consistent access to files using the 'Vertx' file system.</p>
</div>
<div class="paragraph">
<p>The following example shows how create methods were used in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">FaviconHandler.create();
ErrorHandler.create();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how create methods should be used in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">FaviconHandler.create(vertx);
ErrorHandler.create(vertx);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_the_template_engine">Accessing the template engine</h4>
<div class="paragraph">
<p>Use the method <code>TemplateEngine.unwrap()</code> to access the template engine. You can then apply customizations and configurations to the template.</p>
</div>
<div class="paragraph">
<p>The following methods that are used to get and set the engine configurations have been deprecated. Use the <code>TemplateEngine.unwrap()</code> method instead.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HandlebarsTemplateEngine.getHandlebars()</code></p>
</li>
<li>
<p><code>HandlebarsTemplateEngine.getResolvers()</code></p>
</li>
<li>
<p><code>HandlebarsTemplateEngine.setResolvers()</code></p>
</li>
<li>
<p><code>JadeTemplateEngine.getJadeConfiguration()</code></p>
</li>
<li>
<p><code>ThymeleafTemplateEngine.getThymeleafTemplateEngine()</code></p>
</li>
<li>
<p><code>ThymeleafTemplateEngine.setMode()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_locale_interface">Removed the locale interface</h4>
<div class="paragraph">
<p>The <code>io.vertx.ext.web.Locale</code> interface has been removed. Use the <code>io.vertx.ext.web.LanguageHeader</code> interface instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_acceptable_locales_method">Removed the acceptable locales method</h4>
<div class="paragraph">
<p>The <code>RoutingContext.acceptableLocales()</code> method has been removed. Use the <code>RoutingContext.acceptableLanguages()</code> method instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_updated_the_method_for_mounting_sub_routers">Updated the method for mounting sub routers</h4>
<div class="paragraph">
<p>In earlier releases of Vert.x, the <code>Router.mountSubRouter()</code> method incorrectly returned a <code>Router</code>. This has been fixed, and the method now returns a <code>Route</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_create_method_with_excluded_strings_for_jwt_authentication_handling">Removed the create method with excluded strings for JWT authentication handling</h4>
<div class="paragraph">
<p>The <code>JWTAuthHandler.create(JWTAuth authProvider, String skip)</code> method has been removed. Use the <code>JWTAuthHandler.create(JWTAuth authProvider)</code> method instead.</p>
</div>
<div class="paragraph">
<p>The following example shows how JWT authentication handler was created in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">router
   <span class="comment">// protect everything but &quot;/excluded/path&quot;</span>
   .route().handler(JWTAuthHandler(jwtAuth, <span class="string"><span class="delimiter">&quot;</span><span class="content">/excluded/path</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how JWT authentication handler was created in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">router
   .route(<span class="string"><span class="delimiter">&quot;</span><span class="content">/excluded/path</span><span class="delimiter">&quot;</span></span>).handler(<span class="comment">/* public access to &quot;/excluded/path&quot; */</span>)
   <span class="comment">// protect everything</span>
   .route().handler(JWTAuthHandler(jwtAuth)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_create_handler_method_that_was_used_in_osgi_environments">Removed the create handler method that was used in OSGi environments</h4>
<div class="paragraph">
<p>In Vert.x 4, OSGi environment is no longer supported. The <code>StaticHandler.create(String, ClassLoader)</code> method has been removed because the method was used in the OSGi environment.</p>
</div>
<div class="paragraph">
<p>If you have used this method in your applications, then in Vert.x 4 you can either add the resources to the application classpath or serve resources from the file system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_bridge_options_class">Removed the bridge options class</h4>
<div class="paragraph">
<p>The <code>sockjs.BridgeOptions</code> class has been removed. Use the new <code>sockjs.SockJSBridgeOptions</code> class instead. The <code>sockjs.SockJSBridgeOptions</code> class contains all the options that are required to configure the event bus bridge.</p>
</div>
<div class="paragraph">
<p>There is no change in the behavior of the new class, except that the name of the data object class has changed.</p>
</div>
<div class="paragraph">
<p>In previous releases, when you used <code>sockjs.BridgeOptions</code> class to add new bridges, there were a lot of duplicate configurations. The new class contains all the possible common configurations, and removes duplicate configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sockjs_socket_event_bus_does_not_register_a_clustered_event_by_default">SockJS socket event bus does not register a clustered event by default</h4>
<div class="paragraph">
<p><code>SockJSSocket</code> no longer registers a clustered event bus consumer by default. If you want to write to the socket using the event bus, you must enable the <code>writeHandler</code> in <code>SockJSHandlerOptions</code>. When you enable the <code>writeHandler</code>, the event bus consumer is set to local by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">Router router = Router.router(vertx);
SockJSHandlerOptions options = <span class="keyword">new</span> SockJSHandlerOptions()
  .setRegisterWriteHandler(<span class="predefined-constant">true</span>); <span class="comment">// enable the event bus consumer registration</span>
SockJSHandler sockJSHandler = SockJSHandler.create(vertx, options);
router.mountSubRouter(<span class="string"><span class="delimiter">&quot;</span><span class="content">/myapp</span><span class="delimiter">&quot;</span></span>, sockJSHandler.socketHandler(sockJSSocket -&gt; {
  <span class="comment">// Retrieve the writeHandlerID and store it (For example, in a local map)</span>
  <span class="predefined-type">String</span> writeHandlerID = sockJSSocket.writeHandlerID();
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure the event bus consumer to a cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">SockJSHandlerOptions options = <span class="keyword">new</span> SockJSHandlerOptions()
  .setRegisterWriteHandler(<span class="predefined-constant">true</span>) <span class="comment">// enable the event bus consumer registration</span>
  .setLocalWriteHandler(<span class="predefined-constant">false</span>) <span class="comment">// register a clustered event bus consumer</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_method_for_adding_authentication_provider">New method for adding authentication provider</h4>
<div class="paragraph">
<p>The <code>SessionHandler.setAuthProvider(AuthProvider)</code> method has been deprecated. Use the <code>SessionHandler.addAuthProvider()</code> method instead. The new method allows an application to work with multiple authentication providers and link the session objects to these authentication providers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oauth2_authentication_provider_create_methods_require_code_vertx_code_as_constructor_argument">OAuth2 authentication provider create methods require <code>vertx</code> as constructor argument</h4>
<div class="paragraph">
<p>From Vert.x 4, <code>OAuth2Auth.create(Vertx vertx)</code> method requires <code>vertx</code> as a constructor argument. The <code>vertx</code> argument uses a secure non-blocking random number generator to generate nonce which ensures better security for applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-web-graphql_changes-in-common-components">Changes in Vert.x Web GraphQL</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x Web GraphQL.</p>
</div>
<div class="sect3">
<h4 id="_updated_methods_to_be_supported_on_multiple_language_polyglot_environments">Updated methods to be supported on multiple language (polyglot) environments</h4>
<div class="paragraph">
<p>The following methods have been updated and are now supported on polyglot environments:
* <code>UploadScalar</code> is now a factory, use the method  <code>UploadScalar.create()</code> instead.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VertxBatchLoader</code> is now a factory, use the method <code>io.vertx.ext.web.handler.graphql.dataloader.VertxBatchLoader.create()</code> instead.</p>
</li>
<li>
<p><code>VertxDataFetcher</code> is now a factory, use the method <code>io.vertx.ext.web.handler.graphql.schema.VertxDataFetcher.create()</code> instead.</p>
</li>
<li>
<p><code>VertxPropertyDataFetcher</code> is now a factory, use the method  <code>io.vertx.ext.web.handler.graphql.schema.VertxPropertyDataFetcher.create()</code> instead.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_handling_post_requests_in_vert_x_web_graphql">Handling POST requests in Vert.x Web GraphQL</h4>
<div class="paragraph">
<p>In prior releases, the Vert.x Web GraphQL handler could process its own POST requests. It did not need Vert.x Web <code>BodyHandler</code> to process the requests. However, this implementation was susceptible to DDoS attacks.</p>
</div>
<div class="paragraph">
<p>From Vert.x 4 onward, to process POST requests <code>BodyHandler</code> is required. You must install <code>BodyHandler</code> before installing Vert.x Web GraphQL handler.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-micrometer-metrics_changes-in-common-components">Changes in Micrometer metrics</h3>
<div class="paragraph">
<p>The following section describes the changes in Micrometer metrics.</p>
</div>
<div class="sect3">
<h4 id="_tcp_sent_and_received_bytes_are_recorded_as_counters_with_equivalent_http_request_and_response_summaries">TCP sent and received bytes are recorded as counters with equivalent HTTP request and response summaries</h4>
<div class="paragraph">
<p>In prior releases, the following metrics were recorded as distribution summaries for sockets. From Vert.x 4 onward, these metrics are logged as counter, which report the amount of data exchanged.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Net client</p>
<div class="ulist">
<ul>
<li>
<p><code>vertx_net_client_bytes_read</code></p>
</li>
<li>
<p><code>vertx_net_client_bytes_written</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Net server</p>
<div class="ulist">
<ul>
<li>
<p><code>vertx_net_server_bytes_read</code></p>
</li>
<li>
<p><code>vertx_net_server_bytes_written</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For these counters, equivalent distribution summaries have been introduced for HTTP. These summaries are used to collect information about the request and response sizes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP client</p>
<div class="ulist">
<ul>
<li>
<p><code>vertx_http_client_request_bytes</code></p>
</li>
<li>
<p><code>vertx_http_client_response_bytes</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>HTTP server</p>
<div class="ulist">
<ul>
<li>
<p><code>vertx_http_server_request_bytes</code></p>
</li>
<li>
<p><code>vertx_http_server_response_bytes</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_renamed_the_metrics">Renamed the metrics</h4>
<div class="paragraph">
<p>The following metrics have been renamed.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old metrics name</th>
<th class="tableblock halign-left valign-top">New metrics name</th>
<th class="tableblock halign-left valign-top">Updated in components</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_connections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_active_connections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Net client and server</p>
<p class="tableblock">HTTP client and server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_bytesReceived</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_bytes_read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datagram</p>
<p class="tableblock">Net client and server</p>
<p class="tableblock">HTTP client and server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_bytesSent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_bytes_written</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datagram</p>
<p class="tableblock">Net client and server</p>
<p class="tableblock">HTTP client and server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_requests</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_active_requests</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p>
<p class="tableblock">HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_requestCount_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_requests_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p>
<p class="tableblock">HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_responseTime_seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_response_time_seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p>
<p class="tableblock">HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_responseCount_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_responses_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p>
<p class="tableblock">HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_wsConnections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*_active_ws_connections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP client</p>
<p class="tableblock">HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_client_queue_delay_seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_client_queue_time_seconds</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_client_queue_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_client_queue_pending</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_server_requestResetCount_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_http_server_request_resets_total</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_bytesWritten</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_bytes_written</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_bytesRead</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_bytes_read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_replyFailures</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_eventbus_reply_failures</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_queue_delay_seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_queue_time_seconds</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_queue_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_queue_pending</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_inUse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertx_pool_in_use</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-openapi_changes-in-common-components">Changes in Vert.x OpenAPI</h3>
<div class="paragraph">
<p>In Vert.x 4, a new module <code>vertx-web-openapi</code> is available. Use this module alone with <code>vertx-web</code> to develop contract-driven applications.</p>
</div>
<div class="paragraph">
<p>The new module works well with Vert.x Web <code>Router</code>. The new module requires the following Vert.x dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vertx-json-schema</code></p>
</li>
<li>
<p><code>vertx-web-validation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new module is available in the package <code>io.vertx.ext.web.openapi</code>.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the older OpenAPI module <code>vertx-web-api-contract</code> is supported to facilitate the migration to the new module. It is recommended that you move to the new module <code>vertx-web-openapi</code> to take advantage of the new functionality.</p>
</div>
<div class="sect3">
<h4 id="_new_module_uses_router_builder">New module uses router builder</h4>
<div class="paragraph">
<p>The <code>vertx-web-openapi</code> module uses <code>RouterBuilder</code> to build the Vert.x Web router. This router builder is similar to the router builer <code>OpenAPI3RouterFactory</code> in <code>vertx-web-api-contract</code> module.</p>
</div>
<div class="paragraph">
<p>To start working with the <code>vertx-web-openapi</code> module, instantiate the <code>RouterBuilder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">RouterBuilder.create(vertx, <span class="string"><span class="delimiter">&quot;</span><span class="content">petstore.yaml</span><span class="delimiter">&quot;</span></span>).onComplete(ar -&gt; {
  <span class="keyword">if</span> (ar.succeeded()) {
    <span class="comment">// Spec loaded with success</span>
    RouterBuilder routerBuilder = ar.result();
  } <span class="keyword">else</span> {
    <span class="comment">// Something went wrong during router builder initialization</span>
    <span class="predefined-type">Throwable</span> exception = ar.cause();
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also instantiate the <code>RouterBuilder</code> using futures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">RouterBuilder.create(vertx, <span class="string"><span class="delimiter">&quot;</span><span class="content">petstore.yaml</span><span class="delimiter">&quot;</span></span>)
  .onSuccess(routerBuilder -&gt; {
    <span class="comment">// Spec loaded with success</span>
  })
  .onFailure(exception -&gt; {
    <span class="comment">// Something went wrong during router builder initialization</span>
  });</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>vertx-web-openapi</code> module uses the Vert.x file system APIs to load the files. Therefore, you do not have to specify <code>/</code> for the classpath resources. For example, you can specify <code>petstore.yaml</code> in your application. The <code>RouterBuilder</code> can identify the contract from your classpath resources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_new_router_builder_methods">New router builder methods</h4>
<div class="paragraph">
<p>In most cases, you can search and replace usages of old <code>OpenAPI3RouterFactory</code> methods with the new <code>RouterBuilder</code> methods. The following table lists a few examples of old and new methods.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old <code>OpenAPI3RouterFactory</code> methods</th>
<th class="tableblock halign-left valign-top">New <code>RouterBuilder</code> methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.addHandlerByOperationId("getPets", handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.operation("getPets").handler(handler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.addFailureHandlerByOperationId("getPets", handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.operation("getPets").failureHandler(handler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.mountOperationToEventBus("getPets", "getpets.myapplication")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.operation("getPets").routeToEventBus("getpets.myapplication")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.addGlobalHandler(handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.rootHandler(handler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.addBodyHandler(handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.bodyHandler(handler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.getRouter()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.createRouter()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the following syntax to access the parsed request parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">RequestParameters parameters = routingContext.get(io.vertx.ext.web.validation.ValidationHandler.REQUEST_CONTEXT_KEY);
<span class="type">int</span> aParam = parameters.queryParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">aParam</span><span class="delimiter">&quot;</span></span>).getInteger();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_handling_security">Handling security</h4>
<div class="paragraph">
<p>In Vert.x 4, the
methods <code>RouterFactory.addSecurityHandler()</code> and <code>OpenAPI3RouterFactory.addSecuritySchemaScopeValidator()</code> are no longer available.</p>
</div>
<div class="paragraph">
<p>Use the <code>RouterBuilder.securityHandler()</code> method instead. This method accepts <code>io.vertx.ext.web.handler.AuthenticationHandler</code> as an handler. The method automatically recognizes <code>OAuth2Handler</code> and sets up the security schema.</p>
</div>
<div class="paragraph">
<p>The new security handlers also implement the operations defined in the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.3.md#operationObject">OpenAPI specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_handling_common_failures">Handling common failures</h4>
<div class="paragraph">
<p>In <code>vertx-web-openapi</code> module, the following  failure handlers are not available. You must set up failure handlers using the <code>Router.errorHandler(int, Handler)</code> method.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old methods in`vertx-web-api-contract` module</th>
<th class="tableblock halign-left valign-top">New methods in <code>vertx-web-openapi</code> module</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerFactory.setValidationFailureHandler(handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>router.errorHandler(400, handler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>routerBuilder.setNotImplementedFailureHandler(handler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>router.errorHandler(501, handler)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_accessing_the_openapi_contract_model">Accessing the OpenAPI contract model</h4>
<div class="paragraph">
<p>In Vert.x 4, the OpenAPI contract is not mapped to plain old Java object (POJO). So, the additional swagger-parser dependency is no longer required. You can use the getters and resolvers to retrieve specific components of the contract.</p>
</div>
<div class="paragraph">
<p>The following example shows how to retrieve a specific component using a single operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject model = routerBuilder.operation(<span class="string"><span class="delimiter">&quot;</span><span class="content">getPets</span><span class="delimiter">&quot;</span></span>).getOperationModel();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to retrieve the full contract.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject contract = routerBuilder.getOpenAPI().getOpenAPI();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you how to resolve parts of the contract.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject petModel = routerBuilder.getOpenAPI().getCached(JsonPointer.from(<span class="string"><span class="delimiter">&quot;</span><span class="content">/components/schemas/Pet</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_web_requests_without_openapi">Validating web requests without OpenAPI</h4>
<div class="paragraph">
<p>In the <code>vertx-web-api-contract</code> module, you could validate HTTP requests using <code>HTTPRequestValidationHandler</code>. You did not have to use OpenAPI for validations.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, to validate HTTP requests use <code>vertx-web-validation</code> module. You can import this module and validate requests without using OpenAPI. Use <code>ValidationHandler</code> to validate requests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_updates_in_the_vert_x_web_api_service">Updates in the Vert.x web API service</h4>
<div class="paragraph">
<p>The <code>vertx-web-api-service</code> module has been updated and can be used with the <code>vertx-web-validation</code> module. If you are working with <code>vertx-web-openapi</code> module, there is no change in the web service functionality.</p>
</div>
<div class="paragraph">
<p>However, if you do not use OpenAPI, then to use the web service module with <code>vertx-web-validation</code> module you must use the <code>RouteToEBServiceHandler</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">router.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/api/transactions</span><span class="delimiter">&quot;</span></span>)
  .handler(
    ValidationHandlerBuilder.create(schemaParser)
      .queryParameter(optionalParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>, stringSchema()))
      .queryParameter(optionalParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>, stringSchema()))
      .build()
  ).handler(
    RouteToEBServiceHandler.build(eventBus, <span class="string"><span class="delimiter">&quot;</span><span class="content">transactions.myapplication</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">getTransactionsList</span><span class="delimiter">&quot;</span></span>)
  );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>vertx-web-api-service</code> module does not support <code>vertx-web-api-contract</code>. So, when you upgrade to Vert.x 4, you must migrate your Vert.x OpenAPI applications to <code>vertx-web-openapi</code> module.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-in-microservices-patterns_{context}">Changes in microservices patterns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the changes in microservices patterns.</p>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-circuit-breaker_changes-in-microservices-patterns">Changes in Vert.x circuit breaker</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x circuit breaker.</p>
</div>
<div class="sect3">
<h4 id="_removed_execute_command_methods_in_circuit_breaker">Removed execute command methods in circuit breaker</h4>
<div class="paragraph">
<p>The following methods have been removed from the <code>CircuitBreaker</code> class because they cannot be used with futures.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed methods</th>
<th class="tableblock halign-left valign-top">Replacing methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CircuitBreaker.executeCommand()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CircuitBreaker.execute()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CircuitBreaker.executeCommandWithFallback()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CircuitBreaker.executeWithFallback()</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-service-discovery_changes-in-microservices-patterns">Changes in Vert.x service discovery</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x service discovery.</p>
</div>
<div class="sect3">
<h4 id="_removed_create_methods_from_service_discovery_that_contain_code_servicediscovery_code_argument">Removed create methods from service discovery that contain <code>ServiceDiscovery</code> argument</h4>
<div class="paragraph">
<p>The following create methods in service discovery that have <code>Handler&lt;ServiceDiscovery&gt;</code> as an argument have been removed. These methods cannot be used with futures.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed methods</th>
<th class="tableblock halign-left valign-top">Replacing methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceDiscovery.create(&#8230;&#8203;, Handler&lt;ServiceDiscovery&gt; completionHandler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceDiscovery.create(Vertx)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceDiscovery.create(&#8230;&#8203;, Handler&lt;ServiceDiscovery&gt; completionHandler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceDiscovery.create(Vertx, ServiceDiscoveryOptions)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_service_importer_and_exporter_methods_are_no_longer_fluent">Service importer and exporter methods are no longer fluent</h4>
<div class="paragraph">
<p>The <code>ServiceDiscovery.registerServiceImporter()</code> and <code>ServiceDiscovery.registerServiceExporter()</code> methods are no longer fluent. The methods return <code>Future&lt;Void&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kubernetes_service_importer_is_no_longer_registered_automatically">Kubernetes service importer is no longer registered automatically</h4>
<div class="paragraph">
<p>The <code>vertx-service-discovery-bridge-kubernetes</code> adds the <code>KubernetesServiceImporter</code> discovery bridge.
The bridge imports services from Kubernetes or Openshift into the Eclipse Vert.x service discovery.</p>
</div>
<div class="paragraph">
<p>From Vert.x 4, this bridge is no longer registered automatically.
Even if you have added the bridge in the classpath of your project, it will not be automatically registered.</p>
</div>
<div class="paragraph">
<p>You must manually register the bridge after creating the <code>ServiceDiscovery</code> instance.</p>
</div>
<div class="paragraph">
<p>The following example shows you how to manually register the bridge.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject defaultConf = <span class="keyword">new</span> JsonObject();
serviceDiscovery.registerServiceImporter(<span class="keyword">new</span> KubernetesServiceImporter(), defaultConf);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-and-authorization_{context}">Changes in Vert.x authentication and authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections describe the changes in Vert.x authentication and authorization.</p>
</div>
<div class="paragraph">
<p>The Vert.x authentication module has major updates in Vert.x 4. The <code>io.vertx.ext.auth.AuthProvider</code> interface has been split into two new interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.vertx.ext.auth.authentication.AuthenticationProvider</code></p>
</li>
<li>
<p><code>io.vertx.ext.auth.authorization.AuthorizationProvider</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This update enables any provider to independently perform either authentication and authorization.</p>
</div>
<div class="sect2">
<h3 id="migrating-authentication-applications_authentication-and-authorization">Migrating the authentication applications</h3>
<div class="paragraph">
<p>The authentication mechanism has changed at the result level. In earlier releases, the result was a <code>User</code> object, which was provider specific. In Vert.x 4, the result is a common implementation of <code>io.vertx.ext.auth.User</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how a user was authenticated in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject authInfo = <span class="keyword">new</span> JsonObject()
  .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">john</span><span class="delimiter">&quot;</span></span>)
  .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">super$ecret</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// omitting the error handling for brevity</span>
provider.authenticate(authInfo, res -&gt; {
   <span class="keyword">if</span> (res.succeeded()) {
     <span class="comment">// may require type casting for example on Oauth2</span>
     User user = res.result();
   }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to authenticate a user in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">JsonObject authInfo = <span class="keyword">new</span> JsonObject()
  .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">john</span><span class="delimiter">&quot;</span></span>)
  .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">super$ecret</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// omitting the error handling for brevity</span>
provider.authenticate(authInfo, res -&gt; {
   <span class="keyword">if</span> (res.succeeded()) {
     <span class="comment">// Never needs type casting</span>
     User user = res.result();
   }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-authorization-applications_authentication-and-authorization">Migrating the authorization applications</h3>
<div class="paragraph">
<p>Authorization is a new feature in Vert.x 4. In earlier releases, you could only check if a user was authorized to perform the tasks on the <code>User</code> object. This meant that the provider was responsible for both authentication and authorization of the user.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the <code>User</code> object instances are not associated with a particular authentication provider. So you can authenticate and authorize a user using different providers. For example, you can authenticate a user using OAuth2 and perform authorization checks against MongoDB or SQL database.</p>
</div>
<div class="paragraph">
<p>The following example shows how an application checks if a user can use Printer #1234 in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// omitting the error handling for brevity</span>
user.isAuthorized(<span class="string"><span class="delimiter">&quot;</span><span class="content">printers:printer1234</span><span class="delimiter">&quot;</span></span>, res -&gt; {
  <span class="keyword">if</span> (res.succeeded()) {
    <span class="type">boolean</span> hasAuthority = res.result();
    <span class="keyword">if</span> (hasAuthority) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">User can use the printer</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">else</span> {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">User cannot use the printer</span><span class="delimiter">&quot;</span></span>);
    }
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This authorization worked for JDBC and MongoDB. However it did not work for providers such as OAuth2, because the provider did not perform authorization checks. From Vert.x 4, it is possible to perform such authorization checks by using different providers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// omitting the error handling for brevity</span>
provider.getAuthorizations(user, res -&gt; {
  <span class="keyword">if</span> (res.succeeded()) {
    <span class="keyword">if</span> (PermissionBasedAuthorization.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">printer1234</span><span class="delimiter">&quot;</span></span>).match(user)) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">User can use the printer</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">else</span> {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">User cannot use the printer</span><span class="delimiter">&quot;</span></span>);
    }
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check authorizations on roles, permissions, logic operations, wildcards and any other implementation you add.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-key-management_authentication-and-authorization">Changes in key management</h3>
<div class="paragraph">
<p>In Vert.x 4, there are major updates in handling keys. The most important change is that when a key loads, there is no distinction between public buffer and private buffer.</p>
</div>
<div class="paragraph">
<p>The following classes have been updated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.vertx.ext.auth.KeyStoreOptions</code> used to work with <code>jce</code> keystores</p>
</li>
<li>
<p><code>io.vertx.ext.auth.SecretOptions</code> used to handle symmetric secrets</p>
</li>
<li>
<p><code>io.vertx.ext.auth.PubSecKeyOptions</code> used to handle public secret keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section describes the changes in key management.</p>
</div>
<div class="sect3">
<h4 id="_secret_options_class_is_no_longer_available">Secret options class is no longer available</h4>
<div class="paragraph">
<p>The <code>SecretOptions</code> class is no longer available. Use the new <code>PubSecKeyOptions</code> class instead to work with a cryptographic key.</p>
</div>
<div class="paragraph">
<p>The following example shows how methods of <code>SecretOptions</code> class were used in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> SecretOptions()
    .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>)
    .setSecret(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how methods of <code>PubSecKeyOptions</code> class should be used in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> PubSecKeyOptions()
    .setAlgorithm(<span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>)
    .setBuffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updates_in_public_secret_keys_management">Updates in public secret keys management</h4>
<div class="paragraph">
<p>In Vert.x 3.x, the configuration object in public secret key management assumed that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keys are configured as key-pairs.</p>
</li>
<li>
<p>Key data is a PKCS8 encoded string without standard delimiters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to configure key pair in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> PubSecKeyOptions()
  .setPublicKey(
    <span class="comment">// remove the PEM boundaries</span>
    pubPemString
      .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">-----BEGIN PUBLIC KEY----</span><span class="delimiter">&quot;</span></span>)
      .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">-----END PUBLIC KEY----</span><span class="delimiter">&quot;</span></span>))
  .setSecretKey(
    <span class="comment">// remove the PEM boundaries</span>
    secPemString
      .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">-----BEGIN PUBLIC KEY----</span><span class="delimiter">&quot;</span></span>)
      .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">-----END PUBLIC KEY----</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, you must specify both the public and private key.</p>
</div>
<div class="paragraph">
<p>The following example shows how to configure key pair in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">PubSecKeyOptions pubKey =
  <span class="keyword">new</span> PubSecKeyOptions()
    <span class="comment">// the buffer is the exact contents of the PEM file and had boundaries included in it</span>
    .setBuffer(pubPemString);

PubSecKeyOptions secKey =
  <span class="keyword">new</span> PubSecKeyOptions()
    <span class="comment">// the buffer is the exact contents of the PEM file and had boundaries included in it</span>
    .setBuffer(secPemString);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now handle X509 certificates using <code>PubSecKeyOptions</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">PubSecKeyOptions x509Certificate =
  <span class="keyword">new</span> PubSecKeyOptions()
    <span class="comment">// the buffer is the exact contents of the PEM file and had boundaries included in it</span>
    .setBuffer(x509PemString);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changes_in_keystore_management">Changes in keystore management</h4>
<div class="paragraph">
<p>In Vert.x 3.x, <code>KeyStoreOptions</code> assumes that the keystore format is <code>jceks</code>, and the stored password is the same as the password of the key. As <code>jceks</code> is a proprietary format, it is recommended to use a standard format, such as JDK, instead.</p>
</div>
<div class="paragraph">
<p>When you use <code>KeyStoreOptions</code> in Vert.x 4, you can specify a store type. For example, store types such as PKCS11, PKCS12, and so on can be set. The default store type is <code>jceks</code>.</p>
</div>
<div class="paragraph">
<p>In Vert.x 3.x, all keystore entries would share the same password, that is, the keystore password. In Vert.x 4, each keystore entry can have a dedicated password. If you do not want to set password for each keystore entry, you can configure the keystore password as the default password for all entries.</p>
</div>
<div class="paragraph">
<p>The following example shows how to load a <code>jceks</code> keystore in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> KeyStoreOptions()
  .setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/keystore.jks</span><span class="delimiter">&quot;</span></span>)
  .setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore-password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, the default format is assumed to be the default format configured by JDK. The format is <code>PKCS12</code> in Java 9 and above.</p>
</div>
<div class="paragraph">
<p>The following example shows how to load a <code>jceks</code> keystore in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="keyword">new</span> KeyStoreOptions()
  .setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/keystore.jks</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">// Modern JDKs use `jceks` keystore. But this type is not the default</span>
  <span class="comment">// If the type is not set to `jceks` then probably `pkcs12` will be used</span>
  .setType(<span class="string"><span class="delimiter">&quot;</span><span class="content">jceks</span><span class="delimiter">&quot;</span></span>)
  .setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore-password</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">// optionally if your keys have different passwords</span>
  <span class="comment">// and if a key specific id is not provided it defaults to</span>
  <span class="comment">// the keystore password</span>
  .putPasswordProtection(<span class="string"><span class="delimiter">&quot;</span><span class="content">key-id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">key-specific-password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deprecated-and-removed-authentication-and-authorization-methods_authentication-and-authorization">Deprecated and removed authentication and authorization methods</h3>
<div class="paragraph">
<p>The following sections list methods deprecated and removed for authentication and authorization.</p>
</div>
<div class="sect3">
<h4 id="_list_of_removed_authentication_and_authorization_methods">List of removed authentication and authorization methods</h4>
<div class="paragraph">
<p>The following methods have been removed:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed methods</th>
<th class="tableblock halign-left valign-top">Replacing methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.createKeycloak()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KeycloakAuth.create(vertx, JsonObject) ()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.create(Vertx, OAuth2FlowType, OAuth2ClientOptions)()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.create(vertx, new OAuth2ClientOptions().setFlow(YOUR_DESIRED_FLOW))</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.create(Vertx, OAuth2FlowType)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.create(vertx, new OAuth2ClientOptions().setFlow(YOUR_DESIRED_FLOW))</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>User.isAuthorised()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>User.isAuthorized()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>User.setAuthProvider()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessToken.refreshToken()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessToken.opaqueRefreshToken()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vertx.ext.auth.jwt.JWTOptions</code> data object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.vertx.ext.jwt.JWTOptions</code> data object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Oauth2ClientOptions.isUseAuthorizationHeader()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Oauth2ClientOptions.scopeSeparator()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing method</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_list_of_deprecated_authentication_and_authorization_methods">List of deprecated authentication and authorization methods</h4>
<div class="paragraph">
<p>The following methods have been deprecated:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated methods</th>
<th class="tableblock halign-left valign-top">Replacing methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.decodeToken()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthProvider.authenticate()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.introspectToken()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthProvider.authenticate()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.getFlowType()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.loadJWK()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2Auth.jwkSet()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Oauth2ClientOptions.isUseAuthorizationHeader()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing method</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_list_of_deprecated_authentication_and_authorization_classes">List of deprecated authentication and authorization classes</h4>
<div class="paragraph">
<p>The following classes have been deprecated:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated class</th>
<th class="tableblock halign-left valign-top">Replacing class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AbstractUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create user objects using the ` User.create(JsonObject)` method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthOptions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JDBCAuthOptions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JDBCAuthenticationOptions</code> for authentication and <code>JDBCAuthorizationOptions</code> for authorization</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JDBCHashStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OAuth2RBAC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthorizationProvider</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Oauth2Response</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended to use <code>WebClient</code> class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KeycloakHelper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No replacing class</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-in-protocols_{context}">Changes in protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the changes in networking protocols.</p>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-grpc_changes-in-protocols">Changes in Vert.x gRPC</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x gRPC.</p>
</div>
<div class="sect3">
<h4 id="_new_grpc_compiler_plugin">New gRPC compiler plugin</h4>
<div class="paragraph">
<p>In Vert.x 4, the module <code>protoc-gen-grpc-java</code> is no longer available. This module was a fork of the official gRPC compiler. In earlier releases of Vert.x, you had to work with this fork. This fork is maintained by the Eclipse project. Working with the fork was complex.</p>
</div>
<div class="paragraph">
<p>In previous releases, to work with gRPC, the following details were added to <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="comment">&lt;!-- Vert.x 3.x --&gt;</span>
<span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;protocArtifact&gt;</span>com.google.protobuf:protoc:3.2.0:exe:${os.detected.classifier}<span class="tag">&lt;/protocArtifact&gt;</span>
    <span class="tag">&lt;pluginId&gt;</span>grpc-java<span class="tag">&lt;/pluginId&gt;</span>
    <span class="comment">&lt;!-- NOTE: the gav coordinates point to the 3.x only compiler fork --&gt;</span>
    <span class="tag">&lt;pluginArtifact&gt;</span>io.vertx:protoc-gen-grpc-java:${vertx.grpc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/pluginArtifact&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
  ...
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, a new gRPC compiler plugin is available. This plugin uses the official gRPC compiler instead of the fork. To work with the new gRPC plugin, add the following details to <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="comment">&lt;!-- Vert.x 4.0 --&gt;</span>
<span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;protocArtifact&gt;</span>com.google.protobuf:protoc:3.2.0:exe:${os.detected.classifier}<span class="tag">&lt;/protocArtifact&gt;</span>
    <span class="tag">&lt;pluginId&gt;</span>grpc-java<span class="tag">&lt;/pluginId&gt;</span>
    <span class="comment">&lt;!-- NOTE: the gav coordinates point to the official compiler --&gt;</span>
    <span class="tag">&lt;pluginArtifact&gt;</span>io.grpc:protoc-gen-grpc-java:${vertx.grpc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/pluginArtifact&gt;</span>
    <span class="tag">&lt;protocPlugins&gt;</span>
      <span class="comment">&lt;!-- NEW: a plugin is added to generate the Vert.x specific code --&gt;</span>
      <span class="tag">&lt;protocPlugin&gt;</span>
        <span class="tag">&lt;id&gt;</span>vertx-grpc-protoc-plugin<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.vertx<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>vertx-grpc-protoc-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${vertx.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;mainClass&gt;</span>io.vertx.grpc.protoc.plugin.VertxGrpcGenerator<span class="tag">&lt;/mainClass&gt;</span>
      <span class="tag">&lt;/protocPlugin&gt;</span>
    <span class="tag">&lt;/protocPlugins&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
  ...
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_the_generated_code">Migrating the generated code</h4>
<div class="paragraph">
<p>In Vert.x 4, the new compiler is used. When the new gRPC plugin is used, the generated code is not written in the same source file. This is because the compiler does not allow custom code generation on its base class. The plugins must generate a new class with a different name to save the code.</p>
</div>
<div class="paragraph">
<p>In earlier releases of Vert.x, the older gRPC plugin would write the generated code in the same source file.</p>
</div>
<div class="paragraph">
<p>For example, if you have the following descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="proto">service Greeter {
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 3.x, the code would be generated in the <code>GreeterGrpc</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
GreeterGrpc.GreeterVertxImplBase service =
  <span class="keyword">new</span> GreeterGrpc.GreeterVertxImplBase() {
      ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, the code is generated in the <code>VertxGreeterGrpc</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
VertxGreeterGrpc.GreeterVertxImplBase service =
  <span class="keyword">new</span> VertxGreeterGrpc.GreeterVertxImplBase() {
      ...
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_grpc_apis_support_futures">gRPC APIs support futures</h4>
<div class="paragraph">
<p>In Vert.x 4, the gRPC APIs support futures. The gRPC plugin generates promisified APIs. These APIs use the standard Vert.x input and output arguments, which makes it easier to create standard Vert.x applications.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of promise in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
GreeterGrpc.GreeterVertxImplBase service =
  <span class="keyword">new</span> GreeterGrpc.GreeterVertxImplBase() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> sayHello(HelloRequest request, Promise&lt;HelloReply&gt; future) {
          future.complete(
              HelloReply.newBuilder().setMessage(request.getName()).build());
        }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the use of futures in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
VertxGreeterGrpc.GreeterVertxImplBase service =
  <span class="keyword">new</span> VertxGreeterGrpc.GreeterVertxImplBase() {
      <span class="annotation">@Override</span>
      <span class="directive">public</span> <span class="predefined-type">Future</span>&lt;HelloReply&gt; sayHello(HelloRequest request) {
        <span class="keyword">return</span> <span class="predefined-type">Future</span>.succeededFuture(
          HelloReply.newBuilder()
            .setMessage(request.getName())
            .build());
      }
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-mqtt_changes-in-protocols">Changes in Vert.x MQTT</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x MQTT.</p>
</div>
<div class="sect3">
<h4 id="_some_fluent_methods_in_mqtt_clients_return_future">Some fluent methods in MQTT clients return future</h4>
<div class="paragraph">
<p>Some fluent methods in <code>MqttClient</code> class return <code>Future</code> instead of being fluent. For example, methods such as, <code>MqttClient.connect()</code>, <code>MqttClient.disconnect()</code>, <code>MqttClient.publish()</code> return future in Vert.x 4.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of <code>publish()</code> method in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client
   .publish(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Buffer</span>.buffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>), MqttQoS.EXACTLY_ONCE, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>)
   .publish(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Buffer</span>.buffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>), MqttQoS.AT_LEAST_ONCE, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the use of <code>publish()</code> method in Vert.x 4 release.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">client.publish(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Buffer</span>.buffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>), MqttQoS.EXACTLY_ONCE, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>);
client.publish(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Buffer</span>.buffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>), MqttQoS.AT_LEAST_ONCE, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_mqttwill_code_messages_return_buffer"><code>MqttWill</code> messages return buffer</h4>
<div class="paragraph">
<p>The <code>MqttWill</code> data object wraps a string message as an Vert.x buffer instead of a byte array.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removed_the_deprecated_code_mqttwill_code_and_authorization_methods_from_mqtt">Removed the deprecated <code>MqttWill</code> and authorization methods from MQTT</h4>
<div class="paragraph">
<p>The following MQTT methods have been removed:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replacing methods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.willMessage()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.getWillMessage()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.willTopic()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.getWillTopic()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.willQos()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttWill.getWillQos()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttAuth.username()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttAuth.getUsername()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttAuth.password()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttAuth.getPassword()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttClientOptions.setKeepAliveTimeSeconds()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MqttClientOptions.setKeepAliveInterval()</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-service-proxy_changes-in-protocols">Changes in Vert.x Service Proxy</h3>
<div class="paragraph">
<p>The following section describes the changes in service proxy.</p>
</div>
<div class="sect3">
<h4 id="_using_service_proxy_code_generator">Using service proxy code generator</h4>
<div class="paragraph">
<p>The <code>ServiceProxyProcessor</code> class has been removed.</p>
</div>
<div class="paragraph">
<p>To use the service proxy code generator, you must import <code>vertx-codegen</code> with processor classifier in your classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-codegen&lt;/artifactId&gt;
    &lt;classifier&gt;processor&lt;/classifier&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-service-proxy&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Service proxy reuses <code>io.vertx.codegen.CodeGenProcessor</code> from <code>vertx-codegen</code> to start the code generation of service proxy and handler.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-in-client-components_{context}">Changes in client components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the changes in Vert.x clients.</p>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-kafka-client_changes-in-client-components">Changes in Vert.x Kafka client</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x Kafka client.</p>
</div>
<div class="sect3">
<h4 id="_adminutils_class_is_no_longer_available">AdminUtils Class is no longer available</h4>
<div class="paragraph">
<p>The <code>AdminUtils</code> class is no longer available. Use the new <code>KafkaAdminClient</code> class instead to perform administrative operations on a Kafka cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="_flush_methods_use_asynchronous_handler">Flush methods use asynchronous handler</h4>
<div class="paragraph">
<p>The flush methods in <code>KafkaProducer</code> class use <code>Handler&lt;AsyncResult&lt;Void&gt;&gt;</code> instead of <code>Handler&lt;Void&gt;</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-jdbc-client_changes-in-client-components">Changes in Vert.x JDBC client</h3>
<div class="paragraph">
<p>From Vert.x 4, the JDBC client supports SQL client. The SQL common module has also been merged in JDBC client, that is, <code>io.vertx:vertx-sql-common</code> merged in <code>io.vertx:vertx-jdbc-client</code> module. You will have to remove the <code>io.vertx:vertx-sql-common</code> dependency file because <code>io.vertx:vertx-jdbc-client</code> will include it. With the merging of SQL common client, all the database APIs have been consolidated into the JDBC client.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the SQL client has been updated to include the following clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reactive PostgreSQL client. In earlier releases, it included a reactive PostgreSQL client.</p>
</li>
<li>
<p>Reactive MySQL client</p>
</li>
<li>
<p>Reactive DB2 client</p>
</li>
<li>
<p>Continues to include reactive PostgreSQL client. This client was available in Vert.x 3.x releases as well.</p>
</li>
<li>
<p>Existing JDBC client now includes both the JDBC client API and the SQL client API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reactive implementations use the database network protocols. This makes them resource-efficient.</p>
</div>
<div class="paragraph">
<p>JDBC calls to database are blocking calls. The JDBC client uses worker threads to make these calls non-blocking.</p>
</div>
<div class="paragraph">
<p>The following section describes the changes in Vert.x JDBC client.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_pool">Creating a pool</h4>
<div class="paragraph">
<p>In Vert.x 4, you can create a pool using the JDBC client APIs. In earlier releases, you could create only clients. You could not create pools.</p>
</div>
<div class="paragraph">
<p>The following example shows how to create a client in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
SQLClient client = JDBCClient.create(vertx, jsonConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to create a pool in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
JDBCPool pool = JDBCPool.pool(vertx, jsonConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Though the Vert.x 3.x APIs are supported in Vert.x 4, it is recommended that you use the new JDBC client APIs in your applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A pool enables you to perform simple queries. You do not need to manage connections for simple queries. However, for complex queries or multiple queries, you must manage your connections.</p>
</div>
<div class="paragraph">
<p>The following example shows how to manage connections for queries in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
client.getConnection(res -&gt; {
  <span class="keyword">if</span> (res.succeeded()) {
    SQLConnection connection = res.result();
    <span class="comment">// Important, do not forget to return the connection</span>
    connection.close();
  } <span class="keyword">else</span> {
    <span class="comment">// Failed to get connection</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to manage connections for queries in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
pool
  .getConnection()
  .onFailure(e -&gt; {
    <span class="comment">// Failed to get a connection</span>
  })
  .onSuccess(conn -&gt; {
    <span class="comment">// Important, do not forget to return the connection</span>
    conn.close();
  });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_typsesafe_config">Support for Typsesafe Config</h4>
<div class="paragraph">
<p>You can use <code>jsonConfig</code> for configurations. However, using the <code>jsonConfig</code> may sometimes result in errors. To avoid these errors, the JDBC client introduces Typesafe Config.</p>
</div>
<div class="paragraph">
<p>The following example shows the basic structure of a Typesafe Config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x ONLY!!!</span>
JDBCPool pool = JDBCPool.pool(
      vertx,
      <span class="comment">// configure the connection</span>
      <span class="keyword">new</span> JDBCConnectOptions()
        <span class="comment">// H2 connection string</span>
        .setJdbcUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:~/test</span><span class="delimiter">&quot;</span></span>)
        <span class="comment">// username</span>
        .setUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>)
        <span class="comment">// password</span>
        .setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),
      <span class="comment">// configure the pool</span>
      <span class="keyword">new</span> PoolOptions()
        .setMaxSize(<span class="integer">16</span>)
    );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To use Typesafe Config, you must include the <code>agroal</code> connection pool in your project. The pool does not expose many configuration options and makes the configuration easy to use.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_running_sql_queries">Running SQL queries</h4>
<div class="paragraph">
<p>This section shows you how to run queries in the JDBC client.</p>
</div>
<div class="sect4">
<h5 id="_running_one_shot_queries">Running one shot queries</h5>
<div class="paragraph">
<p>The following example shows how to run queries without managing the connection in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
client.query(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user WHERE emp_id &gt; ?</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> JsonArray().add(<span class="integer">1000</span>), res -&gt; {
  <span class="keyword">if</span> (res.succeeded()) {
    <span class="predefined-type">ResultSet</span> rs = res2.result();
    <span class="comment">// You can use these results in your application</span>
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to run queries without managing the connection in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
pool
  .preparedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user WHERE emp_id &gt; ?</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">// the emp id to look up</span>
  .execute(Tuple.of(<span class="integer">1000</span>))
  .onSuccess(rows -&gt; {
    <span class="keyword">for</span> (Row row : rows) {
      <span class="predefined-type">System</span>.out.println(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">FIRST_NAME</span><span class="delimiter">&quot;</span></span>));
    }
  });</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_running_queries_on_managed_connections">Running queries on managed connections</h5>
<div class="paragraph">
<p>The following example shows how to run queries on managed connections in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">pool
  .getConnection()
  .onFailure(e -&gt; {
    <span class="comment">// Failed to get a connection</span>
  })
  .onSuccess(conn -&gt; {
    conn
      .query(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user</span><span class="delimiter">&quot;</span></span>)
      .execute()
      .onFailure(e -&gt; {
        <span class="comment">// Handle the failure</span>
        <span class="comment">// Important, do not forget to return the connection</span>
        conn.close();
      })
      .onSuccess(rows -&gt; {
        <span class="keyword">for</span> (Row row : rows) {
          <span class="predefined-type">System</span>.out.println(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">FIRST_NAME</span><span class="delimiter">&quot;</span></span>));
        }
        <span class="comment">// Important, do not forget to return the connection</span>
        conn.close();
      });
  });</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_stored_procedures">Support for stored procedures</h4>
<div class="paragraph">
<p>Stored procedures are supported in the JDBC client.</p>
</div>
<div class="paragraph">
<p>The following example shows how to pass <code>IN</code> arguments in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
connection.callWithParams(
  <span class="string"><span class="delimiter">&quot;</span><span class="content">{ call new_customer(?, ?) }</span><span class="delimiter">&quot;</span></span>,
  <span class="keyword">new</span> JsonArray().add(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>).add(<span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>),
  <span class="predefined-constant">null</span>,
  res -&gt; {
    <span class="keyword">if</span> (res.succeeded()) {
      <span class="comment">// Success!</span>
    } <span class="keyword">else</span> {
      <span class="comment">// Failed!</span>
    }
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to pass <code>IN</code> arguments in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.0</span>
client
  .preparedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">{call new_customer(?, ?)}</span><span class="delimiter">&quot;</span></span>)
  .execute(Tuple.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Paulo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Lopes</span><span class="delimiter">&quot;</span></span>))
  .onSuccess(rows -&gt; {
    ...
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 3.x, the support for combining  the <code>IN</code> and <code>OUT</code> arguments was very limited due to the available types. In Vert.x 4, the pool is type safe and can handle the combination of <code>IN</code> and <code>OUT</code> arguments. You can also use <code>INOUT</code> parameters in your applications.</p>
</div>
<div class="paragraph">
<p>The following example shows handling of arguments in Vert.x 3.x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 3.x</span>
connection.callWithParams(
  <span class="string"><span class="delimiter">&quot;</span><span class="content">{ call customer_lastname(?, ?) }</span><span class="delimiter">&quot;</span></span>,
  <span class="keyword">new</span> JsonArray().add(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>),
  <span class="keyword">new</span> JsonArray().addNull().add(<span class="string"><span class="delimiter">&quot;</span><span class="content">VARCHAR</span><span class="delimiter">&quot;</span></span>),
  res -&gt; {
    <span class="keyword">if</span> (res.succeeded()) {
      <span class="predefined-type">ResultSet</span> result = res.result();
    } <span class="keyword">else</span> {
      <span class="comment">// Failed!</span>
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows handling of arguments in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// 4.x</span>
client
  .preparedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">{call customer_lastname(?, ?)}</span><span class="delimiter">&quot;</span></span>)
  .execute(Tuple.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>, SqlOutParam.OUT(JDBCType.VARCHAR)))
  .onSuccess(rows -&gt; {
    ...
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the JDBC client, the data types have been updated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For an argument of type <code>OUT</code>, you can specify its return type. In the example, the <code>OUT</code> argument is specified as type <code>VARCHAR</code> which is a JDBC constant.</p>
</li>
<li>
<p>The types are not bound by JSON limitations. You can now use database specific types instead of text constants for the type name.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-mail-client_changes-in-client-components">Changes in Vert.x mail client</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x mail client.</p>
</div>
<div class="sect3">
<h4 id="_code_mailattachment_code_is_available_as_an_interface"><code>MailAttachment</code> is available as an interface</h4>
<div class="paragraph">
<p>From Vert.x 4 onwards, <code>MailAttachment</code> is available as an interface. It enables you to use the mail attachment functionality in a stream. In earlier releases of Vert.x, <code>MailAttachment</code> was available as a class and attachment for mails was represented as a data object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mail_configuration_interface_extends_the_net_client_options">Mail configuration interface extends the net client options</h4>
<div class="paragraph">
<p><code>MailConfig</code> interface extends the <code>NetClientOptions</code> interface. Due to this extension, mail configuration also supports the proxy setting of the <code>NetClient</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-amqp-client_changes-in-client-components">Changes in Vert.x AMQP client</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x AMQP client.</p>
</div>
<div class="sect3">
<h4 id="_removed_methods_in_amqp_client_that_contain_code_amqpmessage_code_argument">Removed methods in AMQP client that contain <code>AmqpMessage</code> argument</h4>
<div class="paragraph">
<p>The AMQP client methods that had <code>Handler&lt;AmqpMessage&gt;</code> as an argument have been removed. In earlier releases, you could set this handler on  <code>ReadStream&lt;AmqpMessage&gt;</code>. However, if you migrate your applications to use futures, such methods cannot be used.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removed methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replacing methods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpClient.createReceiver(String address,  Handler&lt;AmqpMessage&gt; messageHandler, &#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpClient createReceiver(String address, Handler&lt;AsyncResult&lt;AmqpReceiver&gt;&gt; completionHandler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpConnection createReceiver(&#8230;&#8203;, Handler&lt;AsyncResult&lt;AmqpReceiver&gt;&gt; completionHandler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpConnection createReceiver(String address, Handler&lt;AsyncResult&lt;AmqpReceiver&gt;&gt; completionHandler)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpConnection createReceiver(.., Handler&lt;AmqpMessage&gt; messageHandler, Handler&lt;AsyncResult&lt;AmqpReceiver&gt;&gt; completionHandler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AmqpConnection createReceiver(String address, Handler&lt;AsyncResult&lt;AmqpReceiver&gt;&gt; completionHandler)</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-mongodb-client_changes-in-client-components">Changes in Vert.x MongoDB client</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x MongoDB client.</p>
</div>
<div class="sect3">
<h4 id="_methods_removed_from_mongodb_client">Methods removed from MongoDB client</h4>
<div class="paragraph">
<p>The following methods have been removed from <code>MongoClient</code> class.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed methods</th>
<th class="tableblock halign-left valign-top">Replacing methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.update()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.updateCollection()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.updateWithOptions()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.updateCollectionWithOptions()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.replace()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.replaceDocuments()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.replaceWithOptions()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.replaceDocumentsWithOptions()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.remove()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeDocuments()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeWithOptions()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeDocumentsWithOptions()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeOne()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeDocument()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeOneWithOptions()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.removeDocumentsWithOptions()</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-eventbus-javascript-client_changes-in-client-components">Changes in EventBus JavaScript client</h3>
<div class="paragraph">
<p>In Vert.x 4, the EventBus JavaScript client module is available in a new location. You will have to update your build systems to use the module from the new location.</p>
</div>
<div class="paragraph">
<p>In Vert.x 3.x, the event bus JavaScript client was available in various locations, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://repo1.maven.org/maven2/io/vertx/vertx-web/3.9.4/vertx-web-3.9.4-client.js">Maven Central</a></p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/vertx3-eventbus-client">NPM</a></p>
</li>
<li>
<p><a href="https://bower.io/search/?q=vertx3-eventbus-client">Bower.io</a></p>
</li>
<li>
<p><a href="https://cdnjs.com/libraries/vertx">CDNJS</a></p>
</li>
<li>
<p><a href="https://www.webjars.org">webjars</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Vert.x 4, the JavaScript client is available only in <strong>npm</strong>. The EventBus JavaScript client module can be accessed from the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://unpkg.io/@vertx/eventbus-bridge-client.js@1.0.0/vertx-eventbus.js">CDN</a></p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/@vertx/eventbus-bridge-client.js">npm packages</a></p>
<div class="paragraph">
<p>Use the following code in your build scripts to access the module.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSON scripts</p>
<div class="listingblock">
<div class="content">
<pre>{
  "devDependencies": {
    "@vertx/eventbus-bridge-client.js": "1.0.0-1"
  }
}</pre>
</div>
</div>
</li>
<li>
<p>XML scripts</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.webjars.npm<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>vertx__eventbus-bridge-client.js<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.0.0-1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_versioning_of_javascript_client">Versioning of JavaScript client</h4>
<div class="paragraph">
<p>Before Vert.x 4, every Vert.x release included a new release of the JavaScript client.</p>
</div>
<div class="paragraph">
<p>However, from Vert.x 4 onward, a new version of JavaScript client will be available in npm only if there changes in the client. You do not need to update your client application for every Vert.x release, unless there is a version change.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-redis-client_changes-in-client-components">Changes in Vert.x Redis client</h3>
<div class="paragraph">
<p>In Vert.x 4, use the <code>Redis</code> class to work with Redis client. The class <code>RedisClient</code> is no longer available.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NOTE</dt>
<dd>
<p>To help you migrate your applications from <code>RedisClient</code> to <code>Redis</code> class, a helper class <code>RedisAPI</code> is available. <code>RedisAPI</code> enables you to replicate the functionality similar to <code>RedisClient</code> class.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The new class contains all the enhancements in protocols and Redis server features. Use the new class to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Work with all Redis commands</p>
</li>
<li>
<p>Connect to single servers</p>
</li>
<li>
<p>Connect to high availability servers where Redis Sentinel is enabled</p>
</li>
<li>
<p>Connect to cluster configurations of Redis</p>
</li>
<li>
<p>Execute requests in Redis extensions</p>
</li>
<li>
<p>Communicate with both RESP2 and RESP3 server protocol servers</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="migrating-applications-to-new-redis-client_changes-in-vertx-redis-client">Migrating existing Redis client applications to new client</h4>
<div class="paragraph">
<p>You can migrate your existing applications to new <code>Redis</code> client directly or use the helper class <code>RedisAPI</code> to migrate your applications in two steps.</p>
</div>
<div class="paragraph">
<p>Before migrating the applications you must create the client.</p>
</div>
<div class="sect4">
<h5 id="_creating_the_client">Creating the client</h5>
<div class="paragraph">
<p>The following example shows how a Redis client was created in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Create the redis client (3.x)</span>
RedisClient client = RedisClient
  .create(vertx, <span class="keyword">new</span> RedisOptions().setHost(host));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to create a Redis client in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Create the redis client (4.x)</span>
Redis client = Redis
  .createClient(
    vertx,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">redis://server.address:port</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, the client uses the following standard connection string syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java">redis[s]:<span class="comment">//[[user]:password@]server[:port]/[database]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_migrating_applications_to_code_redisapi_code">Migrating applications to <code>RedisAPI</code></h5>
<div class="paragraph">
<p>Using the 'RedisAPI` you can now decide how to manage the connection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can let the client manage the connection for you using a pool.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can control the connection by requesting a new connection. You must ensure to close or return the connection when done.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You must create the client and then update the applications to handle requests.</p>
</div>
<div class="paragraph">
<p>The following example shows how to handle requests after creating the client in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Using 3.x</span>
<span class="comment">// omitting the error handling for brevity</span>
client.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>, s -&gt; {
  <span class="keyword">if</span> (s.succeeded()) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">key stored</span><span class="delimiter">&quot;</span></span>);
    client.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, g -&gt; {
      <span class="keyword">if</span> (s.succeeded()) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retrieved value: </span><span class="delimiter">&quot;</span></span> + s.result());
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to handle requests after creating the client in Vert.x 4. The example uses a list
for setting the key-value pairs instead of hard coding options. See <a href="https://redis.io/commands/set">Redis SET command</a> for more information on arguments available for the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Using 4.x</span>
<span class="comment">// omitting the error handling for brevity</span>

<span class="comment">// 1. Wrap the client into a RedisAPI</span>
api = RedisAPI.api(client);

<span class="comment">// 2. Use the typed API</span>
api.set(
    <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>), s -&gt; {
    <span class="keyword">if</span> (s.succeeded()) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">key stored</span><span class="delimiter">&quot;</span></span>);
      client.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, g -&gt; {
        <span class="keyword">if</span> (s.succeeded()) {
          <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retrieved value: </span><span class="delimiter">&quot;</span></span> + s.result());
        }
      });
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_migrating_applications_directly_to_code_redis_code_client">Migrating applications directly to <code>Redis</code> client</h5>
<div class="paragraph">
<p>When you migrate to the new <code>Redis</code> client directly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can use all the new Redis commands.</p>
</li>
<li>
<p>You can use extensions.</p>
</li>
<li>
<p>You may reduce a few conversions from helper class to new client, which might improve the performance of your application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You must create the client and then update the applications to handle requests.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set and get requests after creating the client in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Using 3.x</span>
<span class="comment">// omitting the error handling for brevity</span>
client.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>, s -&gt; {
  <span class="keyword">if</span> (s.succeeded()) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">key stored</span><span class="delimiter">&quot;</span></span>);
    client.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, g -&gt; {
      <span class="keyword">if</span> (s.succeeded()) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retrieved value: </span><span class="delimiter">&quot;</span></span> + s.result());
      }
    });
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to handle requests after creating the client in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Using 4.x</span>
<span class="comment">// omitting the error handling for brevity</span>

<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vertx.redis.client.Request.cmd</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vertx.redis.client.Command</span>.*;

client.send(cmd(SET).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>), s -&gt; {
    <span class="keyword">if</span> (s.succeeded()) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">key stored</span><span class="delimiter">&quot;</span></span>);
      client.send(cmd(GET).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>), g -&gt; {
        <span class="keyword">if</span> (s.succeeded()) {
          <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retrieved value: </span><span class="delimiter">&quot;</span></span> + s.result());
        }
      });
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Vert.x 4, all the interactions use the <code>send(Request)</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_migrating_responses">Migrating responses</h5>
<div class="paragraph">
<p>In Vert.x 3.x, the client used to hardcode all known commands till Redis 5, and the responses were also typed according to the command.</p>
</div>
<div class="paragraph">
<p>In the new client, the commands are not hardcoded. The responses are of the type <code>Response</code>. The new wire protocol has more range of types.</p>
</div>
<div class="paragraph">
<p>In older client, a response would be of following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>null</code></p>
</li>
<li>
<p><code>Long</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>JsonArray</code></p>
</li>
<li>
<p><code>JsonObject</code> (For <code>INFO</code> and <code>HMGET</code> array responses)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the new client, the response is of following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>null</code></p>
</li>
<li>
<p><code>Response</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Response</code> object has type converters. For example, converters such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>toString()</code></p>
</li>
<li>
<p><code>toInteger()</code></p>
</li>
<li>
<p><code>toBoolean()</code></p>
</li>
<li>
<p><code>toBuffer()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the received data is not of the requested type, then the type converters convert it to the closet possible data type.
When the conversion to a particular type is not possible, the <code>UnsupportedOperationException</code> is thrown. For example, conversion from <code>String</code> to <code>List</code> or <code>Map</code> is not possible.</p>
</div>
<div class="paragraph">
<p>You can also handle collections, because the <code>Response</code> object implements the <code>Iterable</code> interface.</p>
</div>
<div class="paragraph">
<p>The following example shows how to perform a MGET request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span class="comment">// Using 4.x</span>
<span class="comment">// omitting the error handling for brevity</span>

<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vertx.redis.client.Request.cmd</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.vertx.redis.client.Command</span>.*;

client.send(cmd(MGET).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>).arg(<span class="string"><span class="delimiter">&quot;</span><span class="content">key3</span><span class="delimiter">&quot;</span></span>), mget -&gt; {
  mget.result()
    .forEach(value -&gt; {
      <span class="comment">// Use the single value</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="updates-in-vertx-redis-client_changes-in-vertx-redis-client">Updates in Vert.x Redis client</h4>
<div class="paragraph">
<p>This section describes changes in Redis client.</p>
</div>
<div class="sect4">
<h5 id="_removed_deprecated_term_slave_from_redis_roles_and_node_options">Removed deprecated term "slave" from Redis roles and node options</h5>
<div class="paragraph">
<p>The deprecated term "slave" has been replaced with "replica" in Redis roles and node options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Roles</dt>
<dd>
<p>The following example shows you usage of <code>SLAVE</code> role in Vert.x 3.x releases.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>// Before (3.x)
Redis.createClient(
      rule.vertx(),
      new RedisOptions()
        .setType(RedisClientType.SENTINEL)
        .addConnectionString("redis://localhost:5000")
        .setMasterName("sentinel7000")
        .setRole(RedisRole.SLAVE));</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you usage of <code>REPLICA</code> role in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// After (4.0)
Redis.createClient(
      rule.vertx(),
      new RedisOptions()
        .setType(RedisClientType.SENTINEL)
        .addConnectionString("redis://localhost:5000")
        .setMasterName("sentinel7000")
        .setRole(RedisRole.REPLICA));</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Node options</dt>
<dd>
<p>The following example shows you usage of node type <code>RedisSlaves</code> in Vert.x 3.x releases.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>// Before (3.9)
options.setUseSlaves(RedisSlaves);</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows you usage of node type <code>RedisReplicas</code> in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// After (4.0)
options.setUseReplicas(RedisReplicas);</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-cassandra-client_changes-in-client-components">Changes in Vert.x Cassandra client</h3>
<div class="paragraph">
<p>The Vert.x Cassandra client enables applications to interact with an Apache Cassandra service.</p>
</div>
<div class="paragraph">
<p>The following section describes the changes in Vert.x Cassandra client.</p>
</div>
<div class="sect3">
<h4 id="_changes_in_driver_versions">Changes in driver versions</h4>
<div class="paragraph">
<p>In Vert.x 4, the Cassandra client uses Datastax Java driver with version 4.x. This driver version is not backward compatible. You will have to migrate your Vert.x 3.x applications to Vert.x 4. As a part of the migration process, you should import new Datastax driver classes and change the way you create statements.</p>
</div>
<div class="paragraph">
<p>The following example shows Datastax Java driver classes and create statements in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import com.datastax.driver.core.ResultSet;
import com.datastax.driver.core.Row;
import com.datastax.driver.core.SimpleStatement;
import io.vertx.cassandra.CassandraClient;

SimpleStatement statement =
  new SimpleStatement("SELECT release_version FROM system.local");
cassandraClient.execute(statement, done -&gt; {
    ResultSet results = done.result();
    Row row = resultSet.one();
    System.out.println(row.getString("release_version"));
});</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows Datastax Java driver classes and create statements in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import com.datastax.oss.driver.api.core.cql.ResultSet;
import com.datastax.oss.driver.api.core.cql.Row;
import com.datastax.oss.driver.api.core.cql.SimpleStatement;
import io.vertx.cassandra.CassandraClient;

SimpleStatement statement =
  SimpleStatement.newInstance("SELECT release_version FROM system.local");
cassandraClient.execute(statement, done -&gt; {
    ResultSet results = done.result();
    Row row = resultSet.one();
    System.out.println(row.getString("release_version"));
});</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_objects_mappers_are_not_supported">Objects mappers are not supported</h4>
<div class="paragraph">
<p>Object mappers are no longer supported because of changes in Datastax Java driver 4.x.</p>
</div>
<div class="paragraph">
<p>The following mapping construction is not supported in Vert.x 4 release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Table(keyspace = "test", name = "names")
public class MappedClass {
  @PartitionKey
  private String name;
   ...
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updates_in_cassandra_client_options">Updates in Cassandra client options</h4>
<div class="paragraph">
<p>The <code>CassandraClientOptions.setPort()</code>, <code>CassandraClientOptions.getContactPoints()</code>, and <code>CassandraClientOptions.setContactPoints()</code> methods have been removed. Use the <code>CassandraClientOptions.addContactPoint()</code> method instead.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of older methods in Vert.x 3.x releases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import io.vertx.cassandra.CassandraClient;
import io.vertx.cassandra.CassandraClientOptions;
CassandraClientOptions options = new CassandraClientOptions()
  .setContactPoints(List.of("node1.address", "node2.address", "node3.address"))
  .setPort(9142)
  .setKeyspace("my_keyspace");
CassandraClient client = CassandraClient.create(vertx, options);</pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use `CassandraClientOptions.addContactPoint()`method in Vert.x 4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import io.vertx.cassandra.CassandraClient;
import io.vertx.cassandra.CassandraClientOptions;
CassandraClientOptions options = new CassandraClientOptions()
  .addContactPoint("node1.address", 9142)
  .addContactPoint("node2.address", 9142)
  .addContactPoint("node3.address", 9142)
  .setKeyspace("my_keyspace");
CassandraClient client = CassandraClient.create(vertx, options);</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rabbitmq_client">RabbitMQ Client</h3>
<div class="sect3">
<h4 id="_rabbitmqoptions_changes">RabbitMQOptions changes</h4>
<div class="paragraph">
<p>In Vert.x 4 The RabbitMQ options inherits from NetClientOptions to leverage common connection options  including SSL.
Two options have been removed in favor for their base class equivalent, hence they have been renamed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Vert.x RabbitMQOptions  3.x:</span>

RabbitMQOptions options = <span class="keyword">new</span> RabbitMQOptions()
  .setConnectionRetries(<span class="integer">42</span>)
  .setConnectionRetryDelay(<span class="integer">500</span>);


<span class="comment">// Vert.x RabbitMQOptions 4.x:</span>
RabbitMQOptions options = <span class="keyword">new</span> RabbitMQOptions()
  .setReconnectAttempts(<span class="integer">42</span>)
  .setReconnectInterval(<span class="integer">500</span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-in-clustering_{context}">Changes in clustering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the changes in clustering.</p>
</div>
<div class="sect2">
<h3 id="clustered_flag_removed_from_option_classes_changes-in-clustering">Clustered flag removed from options classes</h3>
<div class="paragraph">
<p>The methods and boolean value that were used to specify, get, and set clustering in Vert.x applications have been removed from <code>VertxOptions</code> and <code>EventBusOptions</code> classes.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-hazelcast-cluster-manager_changes-in-clustering">Changes in Hazelcast cluster manager</h3>
<div class="paragraph">
<p>The following section describes the changes in the Hazelcast cluster manager.</p>
</div>
<div class="sect3">
<h4 id="_updates_in_custom_configurations">Updates in custom configurations</h4>
<div class="paragraph">
<p>The Hazelcast cluster manager is based on Hazelcast 4.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the clustering SPI has been redesigned. The subscription data model has changed. As a result of this, Vert.x 3.x nodes and Vert.x 4 nodes cannot be added together in the same Hazelcast cluster.</p>
</div>
<div class="paragraph">
<p>The Vert.x applications are not impacted by this change as the EventBus and SharedData APIs remain the same.</p>
</div>
<div class="paragraph">
<p>If you had a custom Hazelcast configuration file in your Vert.x 3.x application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the map <code>__vertx.nodeInfo</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;map name="__vertx.nodeInfo"&gt;
  &lt;backup-count&gt;1&lt;/backup-count&gt;
&lt;/map&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-infinispan-cluster-manager_changes-in-clustering">Changes in Infinispan cluster manager</h3>
<div class="paragraph">
<p>The following section describes the changes in the Infinispan cluster manager.</p>
</div>
<div class="sect3">
<h4 id="_updates_in_custom_configurations_2">Updates in custom configurations</h4>
<div class="paragraph">
<p>The Infinispan cluster manager is based on Infinispan 12.</p>
</div>
<div class="paragraph">
<p>In Vert.x 4, the clustering SPI has been redesigned. The subscription data model has changed. As a result of this, Vert.x 3.x nodes and Vert.x 4 nodes cannot be added together in the same Infinispan cluster.</p>
</div>
<div class="paragraph">
<p>The Vert.x applications are not impacted by this change as the EventBus and SharedData APIs remain the same.</p>
</div>
<div class="paragraph">
<p>If you had a custom Infinispan configuration file in your Vert.x 3.x application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the <code>__vertx.subs</code> cache type to replicated instead of distributed.</p>
</li>
<li>
<p>Add the replicated cache <code>__vertx.nodeInfo</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre> &lt;cache-container default-cache="distributed-cache"&gt;
    &lt;distributed-cache name="distributed-cache"/&gt;
    &lt;replicated-cache name="__vertx.subs"/&gt;
    &lt;replicated-cache name="__vertx.haInfo"/&gt;
    &lt;replicated-cache name="__vertx.nodeInfo"/&gt;
    &lt;distributed-cache-configuration name="__vertx.distributed.cache.configuration"/&gt;
  &lt;/cache-container&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If you run an Vert.x cluster on Openshift, the <code>infinispan-cloud</code> JAR is no longer needed. The JAR has been removed from the dependencies section of the build file. The configuration files that were bundled in this JAR are now included in the <code>infinispan-core</code> JAR.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-in-ignite-cluster-manager_changes-in-clustering">Changes in Apache Ignite cluster manager</h3>
<div class="paragraph">
<p>The Vert.x Ignite cluster manager has been rewritten to support the new Clustering SPI in Vert.x 4. This should not have any notable difference for the developer.</p>
</div>
<div class="paragraph">
<p>The second change was about the configuration. The reason for doing so was to reduce the transient dependencies introduced by the <code>ignite-spring</code> extension which was used to parse XML configurations.
This change removes more than 10MB of assets from the dependencies.</p>
</div>
<div class="paragraph">
<p>If the cluster manager is used without any configuration changes there is no migration required but if there was a custom <code>ignite.xml</code> used, it can be either switched to the new <code>ignite.json</code> format or the <code>ignite-spring</code> dependency can be added back to you classpath.</p>
</div>
<div class="sect3">
<h4 id="_migrate_to_custom_ignite_json">Migrate to custom ignite.json</h4>
<div class="paragraph">
<p>To overide the <code>default-ignite.json</code> you can simply add <code>ignite.json</code> to your classpath. The json format supports customizing ignite options, cache options, discovery options and ssl options. For further customization you need to fall back to the old XML format.</p>
</div>
<div class="paragraph">
<p>In the example below the default config is extended to activate TLS for cluster communication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">cacheConfiguration</span><span class="delimiter">&quot;</span></span>: [{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">__vertx.*</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cacheMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">REPLICATED</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">readFromBackup</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">atomicityMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ATOMIC</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">writeSynchronizationMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FULL_SYNC</span><span class="delimiter">&quot;</span></span>
  }, {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">cacheMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PARTITIONED</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">readFromBackup</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">atomicityMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ATOMIC</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">writeSynchronizationMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FULL_SYNC</span><span class="delimiter">&quot;</span></span>
  }],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">sslContextFactory</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">protocol</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TLSv1.2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keyStoreFilePath</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server.jks</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">trustStoreFilePath</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">server.jks</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">trustStorePassword</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">trustAll</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">includeEventTypes</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EVT_CACHE_OBJECT_PUT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EVT_CACHE_OBJECT_REMOVED</span><span class="delimiter">&quot;</span></span>],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">metricsLogFrequency</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_migrate_back_to_ignite_xml_with_ignite_spring">Migrate back to ignite.xml with ignite-spring</h4>
<div class="paragraph">
<p>Add the <code>ignite-spring</code> dependency and provide the <code>ignite.xml</code> configuration to your classpath.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.ignite<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>ignite-spring<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${ignite.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.ignite:ignite-spring:${ignite.version}</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example from the original <code>default-ignite.xml</code> for this ClusterManager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:util</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/util</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
                           <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
                           <span class="content">http://www.springframework.org/schema/util</span>
                           <span class="content">http://www.springframework.org/schema/util/spring-util.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.configuration.IgniteConfiguration</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">discoverySpi</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ipFinder</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.spi.discovery.tcp.ipfinder.multicast.TcpDiscoveryMulticastIpFinder</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheConfiguration</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;list&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.configuration.CacheConfiguration</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">__vertx.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REPLICATED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">readFromBackup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicityMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ATOMIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writeSynchronizationMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FULL_SYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.configuration.CacheConfiguration</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTITIONED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">backups</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">readFromBackup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicityMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ATOMIC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">affinity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.cache.affinity.rendezvous.RendezvousAffinityFunction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">partitions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">128</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
          <span class="tag">&lt;/property&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writeSynchronizationMode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FULL_SYNC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
      <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">includeEventTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;list&gt;</span>
        <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.events.EventType.EVT_CACHE_OBJECT_PUT</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.ignite.events.EventType.EVT_CACHE_OBJECT_REMOVED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gridLogger</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.vertx.spi.cluster.ignite.impl.VertxLogger</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metricsLogFrequency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating_clusters_changes-in-clustering">Migrating clusters</h3>
<div class="paragraph">
<p>It is important to decide the migration strategy for your codebase. This is because you cannot add Vert.x 3.x nodes and Vert.x 4 nodes together in a single cluster for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster manager upgrades - Major version upgrades in cluster managers prevent backward compatibility.</p>
</li>
<li>
<p>Subscription data changes - Vert.x has changed the format of the EventBus subscription data stored in cluster managers.</p>
</li>
<li>
<p>Transport protocol changes - Vert.x has changed some fields in the message transport protocol in the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have an Vert.x cluster for a single application or for some closely related microservices, you can migrate the entire codebase to the new cluster at one time.</p>
</div>
<div class="paragraph">
<p>However, if you cannot migrate the codebase at one time, use the recommendations in this section to migrate an Vert.x 3.x codebase to Vert.x 4.</p>
</div>
<div class="sect3">
<h4 id="_splitting_the_cluster">Splitting the cluster</h4>
<div class="paragraph">
<p>If you have a cluster where different teams have deployed verticles for their applications, you can consider splitting the Vert.x 3.x cluster into smaller ones. Note that after splitting the cluster, the separated components will not be able to communicate using the clustering features. You can split the cluster using the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EventBus request and reply - HTTP or RESTful web services, gRPC</p>
</li>
<li>
<p>EventBus send and publish - Messaging systems, Postgres <code>LISTEN</code> and <code>NOTIFY</code>, Redis Pub and Sub</p>
</li>
<li>
<p>Shared Data - Redis, Infinispan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you split the cluster, each team can move to Vert.x 4 when they are ready or if required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_vert_x_eventbus_link">Using Vert.x EventBus Link</h4>
<div class="paragraph">
<p>If you cannot split your cluster, then use <a href="https://github.com/vert-x3/vertx-eventbus-link">Vert.x EventBus Link</a> to migrate your codebase incrementally.</p>
</div>
<div class="paragraph">
<p>Vert.x EventBus Link is a tool that connects an Vert.x 3.x clustered EventBus to an Vert.x 4 clustered EventBus.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The migration of shared data API, that is, maps, counters and locks is not supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tool creates an <code>EventBusLink</code> object that implements the <code>EventBus</code> interface. An instance of <code>EventBusLink</code> is created on at least one node of each cluster. The instance is created by providing a set of addresses and its behavior depends on the message paradigm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>fire and forget</em> and <em>request and reply</em> - The message is sent to the remote cluster.</p>
</li>
<li>
<p><em>publish</em> - The message is sent to both this cluster and the remote cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Vert.x EventBus Link creates a WebSocket server to receive messages and uses a WebSocket client to send them.</p>
</div>
<div class="paragraph">
<p>See the sections <a href="https://github.com/vert-x3/vertx-eventbus-link#getting-started">get started</a> and <a href="https://github.com/vert-x3/vertx-eventbus-link#using">using</a> for more details.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="miscellaneous-changes-in-vertx_{context}">Miscellaneous changes in Vert.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section describes miscellaneous changes in Vert.x 4.</p>
</div>
<div class="sect2">
<h3 id="_removed_the_code_starter_code_class">Removed the <code>Starter</code> class</h3>
<div class="paragraph">
<p>The <code>Starter</code> class has been removed. Use the <code>Launcher</code> class instead to start your Vert.x applications without the <code>main()</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_isolated_deployment_for_java_8">Isolated deployment for Java 8</h3>
<div class="paragraph">
<p>Vert.x 4 supports Java 11. This Java version does not support isolated class loading.
In Vert.x 4, isolated class loading will be supported for Java 8.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_hook_methods_from_vert_x_context">Removed hook methods from Vert.x context</h3>
<div class="paragraph">
<p>The methods <code>Context.addCloseHook()</code> and <code>Context.removeCloseHook()</code> methods have been removed from the <code>Context</code> class. These methods have been moved to the internal interface <code>InternalContext</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_the_clone_methods_from_options">Removed the clone methods from options</h3>
<div class="paragraph">
<p>The methods <code>KeyCertOptions.clone()</code>, <code>TrustOptions.clone()</code>, and <code>SSLEngineOptions.clone()</code> have been removed. Use the methods <code>KeyCertOptions.copy()</code>, <code>TrustOptions.copy()</code>, and <code>SSLEngineOptions.copy()</code> instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_equals_and_hashcode_methods_from_options">Removed equals and hashcode methods from options</h3>
<div class="paragraph">
<p>The <code>VertxOptions.equals()</code> and <code>VertxOptions.hashCode()</code> methods have been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_method_to_check_file_caching">New method to check file caching</h3>
<div class="paragraph">
<p>The <code>VertxOptions.fileResolverCachingEnabled()</code> method has been removed. Use <code>FileSystemOptions.isFileCachingEnabled()</code> method instead to check if file caching has been enabled to resolve classpaths.</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_provider_interface_spi_metrics">Service Provider Interface (SPI) metrics</h3>
<div class="paragraph">
<p>The <code>Metrics.isEnabled()</code> method has been removed. The Service Provider Interface (SPI) metrics will return a null object to indicate that metrics are not enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_the_pooled_buffer_methods">Removed the pooled buffer methods</h3>
<div class="paragraph">
<p>The pooled buffer methods <code>TCPSSLOptions.isUsePooledBuffers()</code> and <code>TCPSSLOptions.setUsePooledBuffers()</code> have been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods_to_create_clients_that_have_no_shared_data_sources">Methods to create clients that have no shared data sources</h3>
<div class="paragraph">
<p>Use the following new methods to create clients that do not have shared data sources with other clients. These methods maintain their own data sources.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated Methods</th>
<th class="tableblock halign-left valign-top">New Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.createNonShared()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MongoClient.create()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JDBCClient.createNonShared()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wJDBCClient.create()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CassandraClient.createNonShared()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CassandraClient.create()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MailClient.createNonShared()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MailClient.create()</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="changes-in-vertx-junit5_{context}">Changes in Vert.x JUnit5</h3>
<div class="paragraph">
<p>The following section describes the changes in Vert.x JUnit5.</p>
</div>
<div class="sect3">
<h4 id="_support_code_vertx_core_code_module_and_updates_in_extensions">Support <code>vertx-core</code> module and updates in extensions</h4>
<div class="paragraph">
<p>The <code>vertx-core</code> module has been updated to use a service provider interface for parameter injection.
This change resulted in following updates in JUnit5:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must call the <code>Vertx</code> parameter before any parameter that requires it for creation. For example, when injecting a <code>WebClient</code>.</p>
</li>
<li>
<p><code>vertx-junit5</code> module supports only the <code>vertx-core</code> module.</p>
</li>
<li>
<p><code>reactiverse-junit5-extensions</code> module hosts extensions that contain extra parameter types, such as, <code>WebClient</code>.</p>
</li>
<li>
<p>RxJava 1 and 2 bindings are now available as <code>vertx-junit5-rx-java</code> and <code>vertx-junit5-rx-java2</code> modules in the <code>vertx-junit5-extensions</code> repository.</p>
<div class="paragraph">
<p>From Eclipse Vert.x 4.1.0, the RxJava 3 binding <code>vertx-junit5-rx-java3</code> is available.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_deprecated_succeeding_and_failing_methods_in_vert_x_text_context">Deprecated succeeding and failing methods in Vert.x text context</h4>
<div class="paragraph">
<p>The <code>VertxTestContext.succeeding()</code> and <code>VertxTestContext.failing()</code> methods have been deprecated. Use <code>VertxTestContext.succeedingThenComplete()</code> and <code>VertxTestContext.failingThenComplete()</code> methods instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin_changes">Kotlin changes</h3>
<div class="sect3">
<h4 id="_generated_coroutine_extension_methods">Generated coroutine extension methods</h4>
<div class="paragraph">
<p>Vert.x 3 generates extension suspending extension methods, e.g <code>get(Handler&lt;AsyncResult&lt;Result&gt;&gt;</code>
generates <code>getAwait()</code> extension method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// getSomethingAwait() is a generated extension method
// and is deprecated
var result = getSomethingAwait();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vert.x 4 provides a future based model and the Vert.x <code>Future</code> has an <code>await()</code> extension methods
that does the same. The code above can simply be rewritten as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">var result = getSomething().await();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_script_compiler">Script compiler</h4>
<div class="paragraph">
<p>Vert.x 3 provides a Kotlin Script compiler based on Kotlin Compiler API.</p>
</div>
<div class="paragraph">
<p>The API often breaks and creates friction for upgrading Kotlin versions.</p>
</div>
<div class="paragraph">
<p>This is removed in Vert.x 4.0.</p>
</div>
<div class="paragraph">
<p>Such scripts should now be handled by Kotlin tools, e.g the Kotlin compiler has options
to compile these scripts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_mongo_db_code">Testing Mongo DB Code</h3>
<div class="paragraph">
<p>The <a href="https://github.com/vert-x3/vertx-embedded-mongo-db">vertx-embedded-mongo-db</a> module is no longer supported in Vert.x 4. An alternative can be <a href="https://github.com/NoEnv/vertx-wiremongo">vertx-wiremongo</a> although it takes a different approach. While vertx-embedded-mongo-db spun up a full blown mongo server, vertx-wiremongo is an alternative in-memory implementation of Vert.x' <code>MongoClient</code> interface that allows specific mocking.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we want to test our persistence layer&#8217;s <code>findApples</code> method to make sure it creates the correct mongo query. Here&#8217;s what such a test may look like with vertx-wiremongo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testFindApples(TestContext ctx) {

  wiremongo.find()
    .inCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">warehouse</span><span class="delimiter">&quot;</span></span>)
    .withQuery(q -&gt; q.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>))
    .returns(<span class="predefined-type">List</span>.of(<span class="keyword">new</span> JsonObject()
      .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>)
      .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mass</span><span class="delimiter">&quot;</span></span>, <span class="integer">161</span>)
      .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">expiration</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> JsonObject()
        .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">$date</span><span class="delimiter">&quot;</span></span>, Instant.now().plus(<span class="integer">7</span>, DAYS)))));

  db.findApples()
    .onSuccess(l -&gt; {
      ctx.assertEquals(<span class="integer">1</span>, l.size());
      ctx.assertEquals(<span class="integer">161</span>, l.get(<span class="integer">0</span>).getInteger(<span class="string"><span class="delimiter">&quot;</span><span class="content">mass</span><span class="delimiter">&quot;</span></span>));
    })
    .onComplete(ctx.asyncAssertSuccess());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A complete documentation can be found <a href="https://github.com/NoEnv/vertx-wiremongo">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-08-28 04:01:05 UTC
</div>
</div>
</body>
</html>